---
title: "我的运维之路-Linux基础"
date: 2016-05-24
layout: post
categories: 
- Linux
tags: 
- Linux 
- 运维
published: true
comments: 
---
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline9">1. 终端</a>
<ul>
<li><a href="#orgheadline1">终端的类型</a>
<ul>
<li><a href="#orgheadline2">物理终端</a></li>
<li><a href="#orgheadline3">虚拟终端</a></li>
<li><a href="#orgheadline4">模拟终端</a></li>
</ul>
</li>
<li><a href="#orgheadline5">交互式接口</a>
<ul>
<li><a href="#orgheadline6">GUI</a></li>
<li><a href="#orgheadline7">CLI</a></li>
</ul>
</li>
<li><a href="#orgheadline8">reset</a></li>
</ul>
</li>
<li><a href="#orgheadline16">2. 命令</a>
<ul>
<li><a href="#orgheadline10">命令的种类</a>
<ul>
<li><a href="#orgheadline11">内建命令</a></li>
<li><a href="#orgheadline12">外部命令</a></li>
</ul>
</li>
<li><a href="#orgheadline13">命令的格式</a></li>
<li><a href="#orgheadline14">命令帮助</a>
<ul>
<li><a href="#orgheadline15">man</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline46">3. 基础命令</a>
<ul>
<li><a href="#orgheadline19">时钟</a>
<ul>
<li><a href="#orgheadline17">系统时钟</a></li>
<li><a href="#orgheadline18">硬件时钟</a></li>
</ul>
</li>
<li><a href="#orgheadline28">目录与文件相关</a>
<ul>
<li><a href="#orgheadline20">文件系统</a></li>
<li><a href="#orgheadline24">cd</a></li>
<li><a href="#orgheadline25">mkdir, rmdir</a></li>
<li><a href="#orgheadline26">ls</a></li>
<li><a href="#orgheadline27">tree</a></li>
</ul>
</li>
<li><a href="#orgheadline33">文件管理</a>
<ul>
<li><a href="#orgheadline29">cp</a></li>
<li><a href="#orgheadline30">dd</a></li>
<li><a href="#orgheadline31">mv</a></li>
<li><a href="#orgheadline32">rm</a></li>
</ul>
</li>
<li><a href="#orgheadline34">文件查找</a>
<ul>
<li><a href="#orgheadline35">locate</a></li>
<li><a href="#orgheadline36">find</a></li>
</ul>
</li>
<li><a href="#orgheadline37"><span class="todo TODO">TODO</span> xargs</a></li>
<li><a href="#orgheadline40">查看文本文件</a>
<ul>
<li><a href="#orgheadline38">cat, tac</a></li>
<li><a href="#orgheadline39">more, less</a></li>
</ul>
</li>
<li><a href="#orgheadline43">系统管理</a>
<ul>
<li><a href="#orgheadline41">关机和重启</a></li>
<li><a href="#orgheadline42">用户登录信息</a></li>
</ul>
</li>
<li><a href="#orgheadline45">监视</a>
<ul>
<li><a href="#orgheadline44">watch</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline51">4. Linux的文件系统</a>
<ul>
<li><a href="#orgheadline47">LSB, FHS: (FileSystem Heirache Standard)</a></li>
<li><a href="#orgheadline48">应用程序的组成部分</a></li>
<li><a href="#orgheadline49">文件类型</a>
<ul>
<li><a href="#orgheadline50">file</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline58">5. 压缩与归档</a>
<ul>
<li><a href="#orgheadline52">常见的压缩与归档工具</a></li>
<li><a href="#orgheadline53">gzip/gunzip</a></li>
<li><a href="#orgheadline54">bzip2/bunzip2</a></li>
<li><a href="#orgheadline55">xz/unxz</a></li>
<li><a href="#orgheadline56">zip/unzip</a></li>
<li><a href="#orgheadline57">tar</a></li>
</ul>
</li>
<li><a href="#orgheadline94">6. Bash</a>
<ul>
<li><a href="#orgheadline59">命令历史</a></li>
<li><a href="#orgheadline60">命令或路径补全和展开</a></li>
<li><a href="#orgheadline61">命令的执行结果</a></li>
<li><a href="#orgheadline62">命令别名(alias)</a></li>
<li><a href="#orgheadline63">glob</a></li>
<li><a href="#orgheadline64">bash的快捷键</a></li>
<li><a href="#orgheadline65">I/O重定向及管道</a>
<ul>
<li><a href="#orgheadline66">I/O重定向</a></li>
<li><a href="#orgheadline67">管道</a></li>
</ul>
</li>
<li><a href="#orgheadline68">Shell脚本</a>
<ul>
<li><a href="#orgheadline69">弱类型与强类型</a></li>
<li><a href="#orgheadline70">shebang</a></li>
<li><a href="#orgheadline71">脚本退出码</a></li>
<li><a href="#orgheadline72">用户交互</a></li>
<li><a href="#orgheadline73">选择执行</a></li>
<li><a href="#orgheadline74">循环执行</a></li>
<li><a href="#orgheadline75">函数</a></li>
<li><a href="#orgheadline76">检查和调试脚本</a></li>
</ul>
</li>
<li><a href="#orgheadline82">bash变量</a>
<ul>
<li><a href="#orgheadline77">变量的生效范围</a></li>
<li><a href="#orgheadline78">本地与环境变量</a></li>
<li><a href="#orgheadline79">局部变量</a></li>
<li><a href="#orgheadline80">只读变量</a></li>
<li><a href="#orgheadline81">位置变量</a></li>
</ul>
</li>
<li><a href="#orgheadline85">bash中的算术计算</a>
<ul>
<li><a href="#orgheadline83">计算命令</a></li>
<li><a href="#orgheadline84">运算符号</a></li>
</ul>
</li>
<li><a href="#orgheadline89">bash的条件测试</a>
<ul>
<li><a href="#orgheadline86">测试命令</a></li>
<li><a href="#orgheadline87">测试符号</a></li>
<li><a href="#orgheadline88">组合条件</a></li>
</ul>
</li>
<li><a href="#orgheadline93">bash的配置文件</a>
<ul>
<li><a href="#orgheadline90">配置文件的类型</a></li>
<li><a href="#orgheadline91">shell登录过程</a></li>
<li><a href="#orgheadline92">载入配置文件的方式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline126">7. 用户和组</a>
<ul>
<li><a href="#orgheadline95">资源分派</a></li>
<li><a href="#orgheadline96">用户: UID</a></li>
<li><a href="#orgheadline97">组: GID</a></li>
<li><a href="#orgheadline98">配置文件</a></li>
<li><a href="#orgheadline114">用户与组相关命令</a>
<ul>
<li><a href="#orgheadline99">查看用户信息: id</a></li>
<li><a href="#orgheadline100">su</a></li>
<li><a href="#orgheadline101">newgrp</a></li>
<li><a href="#orgheadline107">用户相关</a></li>
<li><a href="#orgheadline112">组相关</a></li>
<li><a href="#orgheadline113">其他</a></li>
</ul>
</li>
<li><a href="#orgheadline125">文件权限管理</a>
<ul>
<li><a href="#orgheadline115">三类对象</a></li>
<li><a href="#orgheadline116">基本权限</a></li>
<li><a href="#orgheadline121">特殊权限</a></li>
<li><a href="#orgheadline122">修改文件权限: chmod</a></li>
<li><a href="#orgheadline123">修改文件的属主和属组</a></li>
<li><a href="#orgheadline124">文件遮罩码: umask</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline130">8. 正则表达式</a>
<ul>
<li><a href="#orgheadline127">正则表达式的类型</a></li>
<li><a href="#orgheadline128">基本正则表达式</a></li>
<li><a href="#orgheadline129">扩展正则表达式</a></li>
</ul>
</li>
<li><a href="#orgheadline180">9. Linux磁盘管理</a>
<ul>
<li><a href="#orgheadline131">设备文件</a></li>
<li><a href="#orgheadline135">分区管理</a>
<ul>
<li><a href="#orgheadline132">fdisk</a></li>
<li><a href="#orgheadline133"><span class="todo TODO">TODO</span> parted</a></li>
<li><a href="#orgheadline134"><span class="todo TODO">TODO</span> sfdisk</a></li>
</ul>
</li>
<li><a href="#orgheadline136">文件系统管理</a>
<ul>
<li><a href="#orgheadline137">文件系统</a></li>
<li><a href="#orgheadline141">创建文件系统</a></li>
<li><a href="#orgheadline146">其他常用工具</a></li>
<li><a href="#orgheadline149">文件系统检测</a></li>
</ul>
</li>
<li><a href="#orgheadline155">文件系统管理</a>
<ul>
<li><a href="#orgheadline150">挂载</a></li>
<li><a href="#orgheadline151">卸载</a></li>
<li><a href="#orgheadline152">交换分区</a></li>
<li><a href="#orgheadline153">空间占用查询</a></li>
<li><a href="#orgheadline154">/etc/fstab</a></li>
</ul>
</li>
<li><a href="#orgheadline156">Ext2的块组</a>
<ul>
<li><a href="#orgheadline157">data block</a></li>
<li><a href="#orgheadline158">inodetable</a></li>
<li><a href="#orgheadline159">Superblock</a></li>
<li><a href="#orgheadline160">File system Description</a></li>
<li><a href="#orgheadline161">block bitmap</a></li>
<li><a href="#orgheadline162">inode bitmap</a></li>
</ul>
</li>
<li><a href="#orgheadline166">文件系统的其他概念</a>
<ul>
<li><a href="#orgheadline163">目录</a></li>
<li><a href="#orgheadline164">文件的写入过程</a></li>
<li><a href="#orgheadline165">链接文件</a></li>
</ul>
</li>
<li><a href="#orgheadline167">RAID</a>
<ul>
<li><a href="#orgheadline168">RAID的实现方式</a></li>
<li><a href="#orgheadline169">RAID级别</a></li>
<li><a href="#orgheadline170">软件实现RAID</a></li>
</ul>
</li>
<li><a href="#orgheadline171">LVM2</a>
<ul>
<li><a href="#orgheadline172">设备文件</a></li>
<li><a href="#orgheadline173">pv管理工具</a></li>
<li><a href="#orgheadline174">vg管理命令</a></li>
<li><a href="#orgheadline175">lv管理工具</a></li>
<li><a href="#orgheadline176">快照</a></li>
</ul>
</li>
<li><a href="#orgheadline177">btrfs文件系统</a>
<ul>
<li><a href="#orgheadline178">核心特性</a></li>
<li><a href="#orgheadline179">文件系统相关命令</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
学习Linux使用的过程所做的笔记
</p>




<hr  />
<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9"><span class="section-number-2">1</span> 终端</h2>
<div class="outline-text-2" id="text-1">
<p>
用户与主机交互，必然用到的设备
</p>
</div>
<div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1">终端的类型</h3>
<div class="outline-text-3" id="text-orgheadline1">
<div class="org-src-container">

<pre class="src src-conf">tty  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#24403;&#21069;&#30340;&#32456;&#31471;&#30340;&#35774;&#22791;&#25991;&#20214;</span>
</pre>
</div>
</div>
<div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2">物理终端</h4>
<div class="outline-text-4" id="text-orgheadline2">
<p>
直接接入本机的显示器和键盘设备，在刚开机程序还未启动完全的时候会用到
</p>
<ul class="org-ul">
<li>设备文件: /dev/console</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-4">
<h4 id="orgheadline3">虚拟终端</h4>
<div class="outline-text-4" id="text-orgheadline3">
<p>
附加在物理终端之上的以软件方式虚拟实现的终端
</p>
<pre class="example">
CentOS 6默认启动6个虚拟终端，使用Ctrl+Alt+F[1,6]切换
</pre>
<dl class="org-dl">
<dt>图形终端(也是虚拟终端一种)</dt><dd>附加在物理终端之上的以软件方式虚拟实现的终端，但额外会提供桌面环境</dd>
</dl>


<ul class="org-ul">
<li>设备文件: /dev/tty#</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-4">
<h4 id="orgheadline4">模拟终端</h4>
<div class="outline-text-4" id="text-orgheadline4">
<p>
图形界面下打开的命令行接口，或者基于ssh协议或telnet协议等远程打开的界面
</p>
<ul class="org-ul">
<li>设备文件: /dev/pts/#</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5">交互式接口</h3>
<div class="outline-text-3" id="text-orgheadline5">
<p>
启动终端后，在终端设备附加的一个交互式应用程序
</p>
</div>
<div id="outline-container-orgheadline6" class="outline-4">
<h4 id="orgheadline6">GUI</h4>
<div class="outline-text-4" id="text-orgheadline6">
<p>
X protocol, window manager, desktop
</p>
</div>
</div>
<div id="outline-container-orgheadline7" class="outline-4">
<h4 id="orgheadline7">CLI</h4>
<div class="outline-text-4" id="text-orgheadline7">
<p>
shell程序: sh, csh, tcsh, ksh, bash(GPL), zsh  
</p>
<div class="org-src-container">

<pre class="src src-conf">echo ${SHELL}  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#24403;&#21069;&#20351;&#29992;&#30340;shell</span>
cat /etc/shells  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#24403;&#21069;&#31995;&#32479;&#20351;&#29992;&#30340;&#25152;&#26377;shell</span>
</pre>
</div>
<dl class="org-dl">
<dt>命令提示符</dt><dd><ul class="org-ul">
<li>管理员: #</li>
<li>普通用户: $</li>
</ul></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">reset</h3>
<div class="outline-text-3" id="text-orgheadline8">
<p>
用于重置当前终端
</p>
<ul class="org-ul">
<li>当终端显示出现异常的时候可以使用</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline16" class="outline-2">
<h2 id="orgheadline16"><span class="section-number-2">2</span> 命令</h2>
<div class="outline-text-2" id="text-2">
<p>
提请shell程序找到键入命令所对应的可执行程序或代码，并由其分析后提交给内核分配资源将其运行起来
</p>
</div>
<div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10">命令的种类</h3>
<div class="outline-text-3" id="text-orgheadline10">
<div class="org-src-container">

<pre class="src src-conf">type COMMAND  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#21629;&#20196;&#30340;&#31181;&#31867;</span>
</pre>
</div>
</div>
<div id="outline-container-orgheadline11" class="outline-4">
<h4 id="orgheadline11">内建命令</h4>
<div class="outline-text-4" id="text-orgheadline11">
<p>
由shell自带的，而且通过某命令形式提供
</p>
</div>
</div>
<div id="outline-container-orgheadline12" class="outline-4">
<h4 id="orgheadline12">外部命令</h4>
<div class="outline-text-4" id="text-orgheadline12">
<p>
在当前系统的某文件系统路径下有对应的可执行程序文件
</p>
<div class="org-src-container">

<pre class="src src-conf"><span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#21629;&#20196;&#30340;&#20301;&#32622;</span>
which COMMAND  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#31532;&#19968;&#20010;&#32467;&#26524;</span>
  --skip-alias: &#36339;&#36807;&#21035;&#21517;
whereis COMMAND  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#25152;&#26377;&#32467;&#26524;</span>
</pre>
</div>
<ul class="org-ul">
<li><p>
shell程序搜寻可执行文件的路径定义在 <code>PATH</code> 环境变量中(自左向右)
</p>
<ul class="org-ul">
<li>shell搜寻到的外部命令的路径结果会缓存至内存中的kv(key-value)存储中</li>
<li>但是当外部命令的路径改变时缓存会发生错误，需要修复缓存</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">hash  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#20869;&#23384;&#20013;&#30340;kv&#20648;&#23384;&#30340;&#20869;&#23481;&#21644;&#21629;&#20013;&#27425;&#25968;</span>
hash -r  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#28165;&#31354;&#32531;&#23384;&#20869;&#23481;</span>
</pre>
</div></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13">命令的格式</h3>
<div class="outline-text-3" id="text-orgheadline13">
<p>
COMMAND [OPTIONS&#x2026;] [ARGUMENTS&#x2026;]
</p>
<ul class="org-ul">
<li>选项: 用于启用或关闭命令的某个或某些功能
<ul class="org-ul">
<li>短选项: -la(多个短选项可合并使用)</li>
<li>长选项: &#x2013;word</li>
</ul></li>
<li>参数: 命令的作用对象(向命令提供数据)</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">命令帮助</h3>
<div class="outline-text-3" id="text-orgheadline14">
<dl class="org-dl">
<dt>内建命令</dt><dd><div class="org-src-container">

<pre class="src src-conf">help COMMAND
</pre>
</div></dd>
<dt>外部命令</dt><dd><ol class="org-ol">
<li><code>COMMAND --help</code></li>
<li>使用手册(manual): <code>man COMMAND</code></li>
<li>信息页: <code>info COMMAND</code></li>
<li>程序自身的帮助文档(<code>/usr/share/doc/</code>): README、INSTALL、ChangeLog</li>
<li>程序官方网站文档: Documentation</li>
</ol></dd>
</dl>
</div>

<div id="outline-container-orgheadline15" class="outline-4">
<h4 id="orgheadline15">man</h4>
<div class="outline-text-4" id="text-orgheadline15">
<p>
手册位置: /usr/share/man
</p>
<ul class="org-ul">
<li><p>
man章节
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">man1</td>
<td class="org-left">用户命令</td>
</tr>

<tr>
<td class="org-left">man2</td>
<td class="org-left">系统调用</td>
</tr>

<tr>
<td class="org-left">man3</td>
<td class="org-left">C库调用</td>
</tr>

<tr>
<td class="org-left">man4</td>
<td class="org-left">设备文件及特殊文件</td>
</tr>

<tr>
<td class="org-left">man5</td>
<td class="org-left">配置文件格式</td>
</tr>

<tr>
<td class="org-left">man6</td>
<td class="org-left">游戏</td>
</tr>

<tr>
<td class="org-left">man7</td>
<td class="org-left">杂项</td>
</tr>

<tr>
<td class="org-left">man8</td>
<td class="org-left">管理类的命令</td>
</tr>
</tbody>
</table></li>
<li>有些命令可能存在多个章节中</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">whatis COMMAND  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#21629;&#20196;&#23384;&#22312;&#20110;&#21738;&#20123;&#31456;&#33410;</span>
mandb <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26356;&#26032;whatis&#25968;&#25454;&#24211;</span>
man 3 COMMAND  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;COMMAND(3)&#30340;&#25163;&#20876;</span>
</pre>
</div>
<ul class="org-ul">
<li>man命令的配置文件: /etc/man.config
<ul class="org-ul">
<li>其中，MANPATH /PATH/TO/SOMEWHERE: 指明新的手册文件搜索位置</li>
</ul></li>
<li>手册中SYNOPSIS的符号说明
<ul class="org-ul">
<li><code>[]</code>: 可选内容</li>
<li><code>&lt;&gt;</code>: 必选内容</li>
<li><code>a|b</code>: 二选一</li>
<li><code>...</code>: 同一内容可出现多次</li>
</ul></li>
<li>man命令其实是使用 less 命令来读取文件</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-2">
<h2 id="orgheadline46"><span class="section-number-2">3</span> 基础命令</h2>
<div class="outline-text-2" id="text-3">
<dl class="org-dl">
<dt>echo</dt><dd><div class="org-src-container">

<pre class="src src-conf">echo <span style="color: #E6DB74;">"$VAR_NAME"</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22238;&#26174;&#21629;&#20196;</span>
  -n: &#31105;&#27490;&#33258;&#21160;&#28155;&#21152;&#25442;&#34892;&#31526;&#21495;
  -e: &#20801;&#35768;&#20351;&#29992;&#36716;&#20041;&#31526;
</pre>
</div>
<ul class="org-ul">
<li><p>
使用cat来简化输出多行
</p>
<div class="org-src-container">

<pre class="src src-sh">cat &lt;&lt; EOF
<span style="color: #E6DB74; font-weight: bold;">yesfdsfdf</span>
<span style="color: #E6DB74; font-weight: bold;">fdfsdfssfer</span>
<span style="color: #E6DB74; font-weight: bold;">EOF   # &#23450;&#20041;&#30340;&#32467;&#26463;&#31526;</span>
</pre>
</div></li>
</ul></dd>
</dl>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19">时钟</h3>
<div class="outline-text-3" id="text-orgheadline19">
</div><div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17">系统时钟</h4>
<div class="outline-text-4" id="text-orgheadline17">
<div class="org-src-container">

<pre class="src src-conf">date [OPTION]... [+FORMAT]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#26102;&#38388;</span>
  FORMAT: +%F\ %T &#26085;&#26399; &#26102;&#38388;
date [MMDDhhmm[[CC]YY][.ss]]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#35774;&#32622;&#26102;&#38388;</span>
  CCYY: &#26159;&#22235;&#20301;&#24180;&#20221;
</pre>
</div>
<div class="org-src-container">

<pre class="src src-conf">cal <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#26085;&#21382;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18">硬件时钟</h4>
<div class="outline-text-4" id="text-orgheadline18">
<div class="org-src-container">

<pre class="src src-conf">hwclock [-sw]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#30828;&#20214;&#26102;&#38047;</span>
  <span style="color: #FD971F;">-s</span> == --hctosys 
  <span style="color: #FD971F;">-w</span> == --systohc
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-3">
<h3 id="orgheadline28">目录与文件相关</h3>
<div class="outline-text-3" id="text-orgheadline28">
</div><div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20">文件系统</h4>
<div class="outline-text-4" id="text-orgheadline20">
<dl class="org-dl">
<dt>文件有两类数据</dt><dd><ul class="org-ul">
<li><p>
元数据: metadata(如索引)
</p>
<div class="org-src-container">

<pre class="src src-conf">stat FILE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#33719;&#21462;&#25351;&#23450;&#25991;&#20214;&#30340;&#20803;&#25968;&#25454;</span>
</pre>
</div></li>
<li>数据: data</li>
</ul></dd>
</dl>
</div>

<ul class="org-ul"><li><a id="orgheadline21"></a>文件名<br  /><div class="outline-text-5" id="text-orgheadline21">
<ol class="org-ol">
<li>文件名严格区分字符大小写</li>
<li>文件名可使用除 <code>/</code> 以外的任意字符，不建议使用特殊字符
<ul class="org-ul">
<li>/: 根目录，路径分隔符</li>
</ul></li>
<li>文件名长度最长不能超过255个字符</li>
<li>所有.开头的文件，均为隐藏文件</li>
</ol>
</div></li>

<li><a id="orgheadline22"></a>文件路径<br  /><div class="outline-text-5" id="text-orgheadline22">
<ul class="org-ul">
<li>绝对路径: 从根目录 <code>/</code> 起始的路径</li>
<li>相对路径: 从当前位置(working directory)起始的路径
<ul class="org-ul">
<li>.: 当前目录</li>
<li>..: 当前目录的上一级目录</li>
</ul></li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">pwd  <span style="color: #75715E;"># </span><span style="color: #75715E;">printing working directory</span>
basename PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;PATH&#30340;&#22522;&#21517;</span>
dirname PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;PATH&#38500;&#22522;&#21517;&#20197;&#22806;&#30340;&#37096;&#20998;</span>
</pre>
</div>
</div></li>

<li><a id="orgheadline23"></a>文件时间戳<br  /><div class="outline-text-5" id="text-orgheadline23">
<ul class="org-ul">
<li>access time: 访问时间，简写为atime，读取文件内容</li>
<li>modify time: 修改时间, mtime，改变文件内容(数据)</li>
<li>change time: 改变时间, ctime，元数据发生改变(包含时间戳的改变)</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">touch [OPTION]... FILE...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#25913;&#21464;&#25991;&#20214;&#26102;&#38388;&#25139;&#25110;&#21019;&#24314;&#25991;&#20214;</span>
  -a: only atime  <span style="color: #75715E;"># </span><span style="color: #75715E;">touch&#40664;&#35748;&#25226;3&#20010;&#26102;&#38388;&#37117;&#25913;&#20026;&#24403;&#21069;&#26102;&#38388;</span>
  -m: only mtime
  -t [[CC]YY]MMDDhhmm[.ss]: &#25351;&#23450;&#26102;&#38388;
  -c: &#19981;&#33258;&#21160;&#21019;&#24314;&#31354;&#25991;&#20214;
</pre>
</div>
</div></li></ul>
</div>

<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24">cd</h4>
<div class="outline-text-4" id="text-orgheadline24">
<div class="org-src-container">

<pre class="src src-conf">cd  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22238;&#21040;&#24403;&#21069;&#29992;&#25143;&#30340;&#20027;&#30446;&#24405;</span>
cd ~USERNAME  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20999;&#25442;&#33267;&#25351;&#23450;&#29992;&#25143;&#30340;&#20027;&#30446;&#24405;</span>
cd -  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22312;&#19978;&#19968;&#20010;&#30446;&#24405;&#21644;&#24403;&#21069;&#30446;&#24405;&#20043;&#38388;&#26469;&#22238;&#20999;&#25442;</span>
</pre>
</div>

<dl class="org-dl">
<dt>相关的环境变量</dt><dd><ul class="org-ul">
<li>PWD: 保存了当前的目录路径</li>
<li>OLDPWD: 上一次所在目录路径</li>
</ul></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-4">
<h4 id="orgheadline25">mkdir, rmdir</h4>
<div class="outline-text-4" id="text-orgheadline25">
<div class="org-src-container">

<pre class="src src-conf">mkdir [OPTION]... /path/to...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21019;&#24314;&#30446;&#24405;</span>
  -p: &#24403;&#30446;&#24405;&#23384;&#22312;&#26102;&#19981;&#25253;&#38169;&#65292;&#19988;&#21487;&#33258;&#21160;&#21019;&#24314;&#25152;&#38656;&#30340;&#21508;&#30446;&#24405;&#65307;
  -v: &#26174;&#31034;&#35814;&#32454;&#20449;&#24687;
  -m MODE: &#21019;&#24314;&#30446;&#24405;&#26102;&#30452;&#25509;&#25351;&#23450;&#26435;&#38480;&#65307;
</pre>
</div>
<div class="org-src-container">

<pre class="src src-conf">rmdir [OPTION]... /path/to...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21482;&#33021;&#21024;&#38500;&#31354;&#30446;&#24405;</span>
  -p: &#23618;&#32423;&#21024;&#38500;&#31354;&#30446;&#24405; 
  -v: &#26174;&#31034;&#35814;&#32454;&#20449;&#24687;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26">ls</h4>
<div class="outline-text-4" id="text-orgheadline26">
<p>
显示指定路径下的文件列表
</p>
<div class="org-src-container">

<pre class="src src-conf">ls [OPTION]... [DIR]...
  -a, --all: &#26174;&#31034;&#25152;&#26377;&#25991;&#20214;&#65292;&#21253;&#25324;&#38544;&#34255;&#25991;&#20214;
  -l: &#38271;&#26684;&#24335;
  -h, --human-readable: &#21333;&#20301;&#25442;&#31639;
  -d: &#26174;&#31034;&#30446;&#24405;&#33258;&#36523;&#30340;&#30456;&#20851;&#23646;&#24615;&#65292;&#36890;&#24120;&#35201;&#19982;-l&#19968;&#36215;&#20351;&#29992;
  -r, --reverse: &#36870;&#24207;&#26174;&#31034;
  -R, --recursive: &#36882;&#24402;
  -Z: &#26174;&#31034;SELinux&#26435;&#38480;
</pre>
</div>
<dl class="org-dl">
<dt>长格式</dt><dd><img src="ls.gif" alt="ls.gif" />
<ul class="org-ul">
<li>-rw-r&#x2013;r&#x2013; 最左侧的一位表示文件类型</li>
</ul></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-4">
<h4 id="orgheadline27">tree</h4>
<div class="outline-text-4" id="text-orgheadline27">
<p>
列出目录的层级结构
</p>
<div class="org-src-container">

<pre class="src src-conf">tree /path/to 
  -d: &#21482;&#26174;&#31034;&#30446;&#24405;
  -L level: &#25351;&#23450;&#26174;&#31034;&#30340;&#23618;&#32423;&#25968;&#30446;
  -P pattern: &#21482;&#26174;&#31034;&#30001;&#25351;&#23450;pattern&#21305;&#37197;&#21040;&#30340;&#36335;&#24452;&#65307;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-3">
<h3 id="orgheadline33">文件管理</h3>
<div class="outline-text-3" id="text-orgheadline33">
</div><div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29">cp</h4>
<div class="outline-text-4" id="text-orgheadline29">
<p>
通过文件接口复制
</p>
<div class="org-src-container">

<pre class="src src-conf">cp [OPTION]... SOURCE... DIRECTORY
cp [OPTION]... -t DIRECTORY SOURCE...
  -i: &#20132;&#20114;&#24335;
  -r, -R: &#36882;&#24402;&#22797;&#21046;&#30446;&#24405;&#21450;&#20869;&#37096;&#30340;&#25152;&#26377;&#20869;&#23481;&#65307;
  <span style="color: #FD971F;">-a: &#24402;&#26723;&#65292;&#30456;&#24403;&#20110;-dr --preserv</span>=all
    -d: &#19981;&#36319;&#36394;&#31526;&#21495;&#25991;&#20214;&#38142;&#25509;(&#40664;&#35748;&#20250;&#36319;&#36394;&#22797;&#21046;&#21407;&#25991;&#20214;)
    <span style="color: #FD971F;">--preserv[</span>=ATTR_LIST]: &#20445;&#30041;&#23646;&#24615;
      ATTR_LIST: mode,ownership,timestamp,links,xattr,context,all
  <span style="color: #FD971F;">-p: --preserv</span>=mode,ownership,timestamp
  -v: &#26174;&#31034;&#35814;&#32454;&#20449;&#24687;verbose
  -f: --force
</pre>
</div>
<ul class="org-ul">
<li>cp SRC DEST
<ul class="org-ul">
<li>如果目标不存在: 新建DEST，并将SRC中内容填充到DEST中</li>
<li>如果目标存在: 
<ul class="org-ul">
<li>如果DEST是文件: 将SRC中的内容覆盖到DEST中(使用-i以确认)</li>
<li>如果DEST是目录: 将SRC复制到该目录下</li>
</ul></li>
</ul></li>
<li>cp SRC&#x2026; DEST
<ul class="org-ul">
<li>DEST必须存在，且为目录</li>
</ul></li>
<li>cp -r 目录SRC DEST
<ul class="org-ul">
<li>如果目标不存在: 新建DEST目录，复制SRC中所有文件至DEST中</li>
<li>如果DEST存在且为目录: 在DEST中创建与SRC同名的目录，复制SRC中的所有文件至该目录中</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30">dd</h4>
<div class="outline-text-4" id="text-orgheadline30">
<p>
比较底层的复制命令，可用于文件或磁盘的复制
</p>
<div class="org-src-container">

<pre class="src src-sh">dd <span style="color: #AE81FF;">[</span>OPTIONS<span style="color: #AE81FF;">]</span> <span style="color: #FD971F;">if</span>=/PATH/SRC <span style="color: #FD971F;">of</span>=/PATH/DEST
  <span style="color: #FD971F;">bs</span>=NUM: block size, &#22797;&#21046;&#21333;&#20803;&#30340;&#22823;&#23567;
  <span style="color: #FD971F;">count</span>=NUM: &#22797;&#21046;&#22810;&#23569;&#20010;bs

dd <span style="color: #FD971F;">if</span>=/dev/sda <span style="color: #FD971F;">of</span>=/dev/sdb  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22797;&#21046;&#30913;&#30424;</span>
dd <span style="color: #FD971F;">if</span>=/dev/sda <span style="color: #FD971F;">of</span>=/... <span style="color: #FD971F;">bs</span>=<span style="color: #AE81FF;">512</span> <span style="color: #FD971F;">count</span>=<span style="color: #AE81FF;">1</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22791;&#20221;MBR</span>
dd <span style="color: #FD971F;">if</span>=/dev/zero <span style="color: #FD971F;">of</span>=/dev/sda <span style="color: #FD971F;">bs</span>=<span style="color: #AE81FF;">256</span> <span style="color: #FD971F;">count</span>=<span style="color: #AE81FF;">1</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#30772;&#22351;MBR&#30340;bootloader</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31">mv</h4>
<div class="outline-text-4" id="text-orgheadline31">
<p>
移动文件或目录，也可以用于重命名
</p>
<div class="org-src-container">

<pre class="src src-conf">mv [OPTION]... SOURCE... DIRECTORY
mv [OPTION]... -t DIRECTORY SOURCE...
  -i: &#20132;&#20114;&#24335;
  -f: &#24378;&#21046;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32">rm</h4>
<div class="outline-text-4" id="text-orgheadline32">
<p>
删除文件或目录
</p>
<div class="org-src-container">

<pre class="src src-conf">rm [OPTION]... FILE...
  -i: &#20132;&#20114;&#24335;
  -f: &#24378;&#21046;&#21024;&#38500;
  -r: &#36882;&#24402;&#21024;&#38500;&#30446;&#24405;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34">文件查找</h3>
<div class="outline-text-3" id="text-orgheadline34">
<p>
在文件系统上查找符合条件的文件
</p>
<dl class="org-dl">
<dt>文件查找的类型</dt><dd><ul class="org-ul">
<li>非实时的查找(数据库查找): locate</li>
<li>实时查找: find</li>
</ul></dd>
</dl>
</div>

<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35">locate</h4>
<div class="outline-text-4" id="text-orgheadline35">
<ul class="org-ul">
<li>依赖于事先构建的索引进行搜索
<ul class="org-ul">
<li>索引的构建是在系统较为空闲时自动进行(周期性任务)</li>
<li>手动更新数据库(<code>updatedb</code>)</li>
<li>索引构建过程需要遍历整个根文件系统，极消耗资源，小心使用</li>
</ul></li>
<li>工作特点
<ul class="org-ul">
<li>查找速度快</li>
<li>模糊查找</li>
<li>非实时查找</li>
</ul></li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">locate KEYWORD
updatedb
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36">find</h4>
<div class="outline-text-4" id="text-orgheadline36">
<p>
实时查找工具，通过遍历指定路径下的文件系统完成文件查找
</p>
<ul class="org-ul">
<li>工作特点
<ul class="org-ul">
<li>查找速度略慢</li>
<li>精确查找</li>
<li>实时查找</li>
</ul></li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">find [OPTION]... [&#26597;&#25214;&#36335;&#24452;] [&#26597;&#25214;&#26465;&#20214;] [&#22788;&#29702;&#21160;&#20316;]
  &#26597;&#25214;&#36335;&#24452;: &#25351;&#23450;&#20855;&#20307;&#30446;&#26631;&#36335;&#24452;(&#40664;&#35748;&#20026;&#24403;&#21069;&#30446;&#24405;)
  &#26597;&#25214;&#26465;&#20214;: &#25351;&#23450;&#30340;&#26597;&#25214;&#26631;&#20934;&#65292;&#21487;&#20197;&#25991;&#20214;&#21517;&#12289;&#22823;&#23567;&#12289;&#31867;&#22411;&#12289;&#26435;&#38480;&#31561;&#26631;&#20934;&#36827;&#34892;(&#40664;&#35748;&#20026;&#25214;&#20986;&#25351;&#23450;&#36335;&#24452;&#19979;&#30340;&#25152;&#26377;&#25991;&#20214;)
  &#22788;&#29702;&#21160;&#20316;: &#23545;&#31526;&#21512;&#26465;&#20214;&#30340;&#25991;&#20214;&#20570;&#20160;&#20040;&#25805;&#20316;(&#40664;&#35748;&#36755;&#20986;&#33267;&#23631;&#24149;)

  -Olevel:
</pre>
</div>


<dl class="org-dl">
<dt>查找条件</dt><dd><ul class="org-ul">
<li>根据文件名查找
<ul class="org-ul">
<li>-name "文件名称": 支持使用glob</li>
<li>-iname "文件名称": 不区分字母大小写</li>
<li>-regex "PATTERN": 以PATTERN匹配整个文件路径字符串，而不仅仅是文件名称</li>
</ul></li>
<li>根据属主/组查找
<ul class="org-ul">
<li>-user USERNAME: 查找属主为指定用户的文件</li>
<li>-group GROUPNAME: 查找属组为指定组的文件</li>
<li>-uid UID: 查找属主为指定的UID号的文件</li>
<li>-gid GID: 查找属组为指定的GID号的文件</li>
<li>-nouser: 查找没有属主的文件</li>
<li>-nogroup: 查找没有属组的文件</li>
</ul></li>
<li>根据文件类型查找
<ul class="org-ul">
<li>-type TYPE: TYPE可以是f/d/l/s/b/c/p</li>
</ul></li>
<li>根据文件大小查找
<ul class="org-ul">
<li>-size [+|-]NUM[k|M|G]
<ul class="org-ul">
<li>NUM: (NUM-1, NUM]</li>
<li>-NUM: [0, NUM-1]</li>
<li>+NUM: (NUM, oo)</li>
</ul></li>
</ul></li>
<li>根据时间戳，即多少时间之前
<ul class="org-ul">
<li>以天为单位
<ul class="org-ul">
<li>-atime [+|-]NUM</li>
<li>-mtime [+|-]NUM</li>
<li>-ctime [+|-]NUM</li>
</ul></li>
<li>以分钟为单位
<ul class="org-ul">
<li>-amin [+|-]NUM</li>
<li>-mmin [+|-]NUM</li>
<li>-cmin [+|-]NUM</li>
</ul></li>
<li>NUM的含义
<ul class="org-ul">
<li>NUM: [NUM, NUM+1)</li>
<li>-NUM: [0, NUM)</li>
<li>+NUM: [#+1,oo]</li>
</ul></li>
</ul></li>
<li>根据权限查找:
<ul class="org-ul">
<li>-perm [/|-]MODE
<ul class="org-ul">
<li>MODE: 精确权限匹配</li>
<li>/MODE: 任何一类(u,g,o)对象的权限中只要能一位匹配即可(或关系)</li>
<li>-MODE: 每一类对象都必须同时拥有为其指定的权限标准(与关系)</li>
</ul></li>
</ul></li>
<li>组合条件
<ul class="org-ul">
<li>与: -a(可省略)</li>
<li>或: -o</li>
<li>非: -not, !</li>
<li>组合条件同时也会将处理动作分开，即处理动作只作用与后半部分的结果。所以最好用括号 <code>\( \)</code> 将查找条件与处理动作分开</li>
</ul></li>
</ul></dd>
<dt>处理动作</dt><dd><ul class="org-ul">
<li>-print: 默认的处理动作，显示至屏幕</li>
<li>-ls: 类似于对查找到的文件执行“ls -l”命令</li>
<li>-delete: 删除查找到的文件，小心操作</li>
<li>-fls /path/to/somefile: 查找到的所有文件的长格式信息保存至指定文件中</li>
<li>-exec COMMAND {} \; : 对查找到的每个文件执行由COMMAND指定的命令</li>
<li><p>
-ok COMMAND {} \; : 对查找到的每个文件执行由COMMAND指定的命令，执行前会交互式要求用户确认
</p>
<ul class="org-ul">
<li>{}: 用于引用查找到的文件名称自身</li>
</ul>
<ul class="org-ul">
<li>注意: find传递查找到的文件至后面指定的命令时，查找到所有符合条件的文件一次性传递给后面的命令，有些命令不能接受过多参数，可以使用 <code>find | xargs COMMAND</code> 来解决</li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgheadline37" class="outline-3">
<h3 id="orgheadline37"><span class="todo TODO">TODO</span> xargs</h3>
</div>

<div id="outline-container-orgheadline40" class="outline-3">
<h3 id="orgheadline40">查看文本文件</h3>
<div class="outline-text-3" id="text-orgheadline40">
</div><div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38">cat, tac</h4>
<div class="outline-text-4" id="text-orgheadline38">
<div class="org-src-container">

<pre class="src src-conf">cat [OPTION]... [FILE]...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#36830;&#25509;&#25991;&#20214;&#65292;&#28982;&#21518;&#26174;&#31034;&#21040;&#23631;&#24149;&#19978;</span>
  -A: &#26174;&#31034;&#25152;&#26377;&#29305;&#27530;&#23383;&#31526;
  -n: &#23545;&#26174;&#31034;&#30340;&#27599;&#19968;&#34892;&#36827;&#34892;&#32534;&#21495;
tac [OPTION]... [FILE]...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#36830;&#25509;&#25991;&#20214;&#65292;&#28982;&#21518;&#20498;&#36807;&#26469;&#26174;&#31034;&#21040;&#23631;&#24149;&#19978;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39">more, less</h4>
<div class="outline-text-4" id="text-orgheadline39">
<p>
more和less可以对长文章进行翻页，less更常用
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-3">
<h3 id="orgheadline43">系统管理</h3>
<div class="outline-text-3" id="text-orgheadline43">
</div><div id="outline-container-orgheadline41" class="outline-4">
<h4 id="orgheadline41">关机和重启</h4>
<div class="outline-text-4" id="text-orgheadline41">
<ul class="org-ul">
<li><p>
reboot, halt, poweroff 都会通过调用shutdown来使用
</p>
<div class="org-src-container">

<pre class="src src-sh">shutdown <span style="color: #AE81FF;">[</span>OPTION<span style="color: #AE81FF;">]</span>... TIME <span style="color: #AE81FF;">[</span>MESSAGE<span style="color: #AE81FF;">]</span>
  -r: reboot
  -h: halt
  -c: cancel
  TIME: now: &#31435;&#21051;
        +m: &#30456;&#23545;&#26102;&#38388;
        hh:mm: &#32477;&#23545;&#26102;&#38388;
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline42" class="outline-4">
<h4 id="orgheadline42">用户登录信息</h4>
<div class="outline-text-4" id="text-orgheadline42">
<ul class="org-ul">
<li>whoami: 显示当前登录有效用户</li>
<li>who: 系统当前所有的登录会话</li>
<li>w: 系统当前所有的登录会话及所做的操作</li>
<li>last: 显示所有用户的登录历史</li>
<li>lastlog: 显示每个用户的最后一次登录时间</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline45" class="outline-3">
<h3 id="orgheadline45">监视</h3>
<div class="outline-text-3" id="text-orgheadline45">
</div><div id="outline-container-orgheadline44" class="outline-4">
<h4 id="orgheadline44">watch</h4>
<div class="outline-text-4" id="text-orgheadline44">
<p>
重复运行某命令并输出结果
</p>
<div class="org-src-container">

<pre class="src src-conf">watch <span style="color: #E6DB74;">'COMMAND'</span>
  -n num: &#21047;&#26032;&#38388;&#38548;
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline51" class="outline-2">
<h2 id="orgheadline51"><span class="section-number-2">4</span> Linux的文件系统</h2>
<div class="outline-text-2" id="text-4">
<dl class="org-dl">
<dt>根文件系统(rootfs)</dt><dd>root filesystem</dd>
</dl>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="orgheadline47">LSB, FHS: (FileSystem Heirache Standard)</h3>
<div class="outline-text-3" id="text-orgheadline47">
<ul class="org-ul">
<li>/boot: 引导文件存放目录，内核文件(vmlinuz)、引导加载器(bootloader, grub)都存放于此目录</li>
<li>/bin: 供所有用户使用的基本命令；不能关联至独立分区，OS启动即会用到的程序</li>
<li>/sbin: 管理类的基本命令；不能关联至独立分区，OS启动即会用到的程序</li>
<li>/lib: 基本共享库文件，以及内核模块文件(/lib/modules)</li>
<li>/lib64: 专用于x86_64系统上的辅助共享库文件存放位置</li>
<li>/etc: 配置文件目录(纯文本文件)
<ul class="org-ul">
<li>/etc/opt: 安装在/opt下的软件配置文件</li>
<li>/etc/X11: X Window System的配置文件</li>
<li>/etc/xml</li>
<li>/etc/sgml</li>
</ul></li>
<li>/home/USERNAME: 普通用户家目录</li>
<li>/root: 管理员的家目录</li>
<li>/media: 便携式移动设备(cdrom, usb)挂载点</li>
<li>/mnt: 临时文件系统挂载点</li>
<li>/dev: 设备文件及特殊文件存储位置
<ul class="org-ul">
<li>b: block device，随机访问</li>
<li>c: character device，线性访问</li>
</ul></li>
<li>/opt: 第三方应用程序的安装位置</li>
<li>/srv: 系统上运行的服务用到的数据</li>
<li>/tmp: 临时文件存储位置</li>
<li>/usr: universal shared, read-only data
<ul class="org-ul">
<li>/usr/bin: 保证系统拥有完整功能而提供的应用程序</li>
<li>/usr/sbin: 管理类命令</li>
<li>/usr/lib:</li>
<li>/usr/lib64:</li>
<li>/usr/include: C程序的头文件(header files)，描述库文件的调用接口</li>
<li>/usr/share: 结构化独立的数据，例如doc, man等</li>
<li>/usr/src: 源代码放置位置</li>
<li>/usr/local: 第三方应用程序的安装位置
<ul class="org-ul">
<li>bin, sbin, lib, lib64, etc, share</li>
</ul></li>
</ul></li>
<li>/var: variable data files
<ul class="org-ul">
<li>/var/cache: 应用程序缓存数据目录</li>
<li>/var/lib: 应用程序状态信息数据</li>
<li>/var/local: 专用于为/usr/local下的应用程序存储可变数据</li>
<li>/var/lock: 锁文件</li>
<li>/var/log: 日志目录及文件</li>
<li>/var/mail: 存放邮件</li>
<li>/var/opt: 专用于为/opt下的应用程序存储可变数据</li>
<li>/var/run: 运行中的进程相关的数据；通常用于存储进程的pid文件</li>
<li>/var/spool: 应用程序数据池</li>
<li>/var/tmp: 保存系统两次重启之间产生的临时数据</li>
</ul></li>
<li>/proc: 用于输出内核与进程信息相关的虚拟文件系统</li>
<li>/sys: 用于输出当前系统上硬件设备相关信息的虚拟文件系统</li>
<li>/selinux: security enhanced Linux，selinux相关的安全策略等信息的存储位置；</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-3">
<h3 id="orgheadline48">应用程序的组成部分</h3>
<div class="outline-text-3" id="text-orgheadline48">
<ul class="org-ul">
<li>二进制程序: /bin, /sbin, /usr/bin, /usr/sbin, /usr/local/bin, /usr/local/sbin</li>
<li>库文件: /lib, /lib64, /usr/lib, /usr/lib64, /usr/local/lib, /usr/local/lib64</li>
<li>配置文件: /etc, /etc/DIRECTORY, /usr/local/etc</li>
<li>帮助文件: /usr/share/man, /usr/share/doc, /usr/local/share/man, /usr/local/share/doc</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-3">
<h3 id="orgheadline49">文件类型</h3>
<div class="outline-text-3" id="text-orgheadline49">
<ul class="org-ul">
<li>-(f): 普通文件(纯文本文件\二进制文件\数据文件)</li>
<li>d: 目录</li>
<li>l: 连接文件, 类似windows下快捷方式</li>
<li>b: 块设备文件(可存储数据, 随机访问)</li>
<li>c: 字符设备文件(鼠标\键盘&lt;-串行端口设备)</li>
<li>s: sockets</li>
<li>p: 管道(FIFO)</li>
</ul>
</div>
<div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50">file</h4>
<div class="outline-text-4" id="text-orgheadline50">
<p>
查看文件内容的类型 
</p>
<div class="org-src-container">

<pre class="src src-conf">file FILE
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline58" class="outline-2">
<h2 id="orgheadline58"><span class="section-number-2">5</span> 压缩与归档</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-orgheadline52" class="outline-3">
<h3 id="orgheadline52">常见的压缩与归档工具</h3>
<div class="outline-text-3" id="text-orgheadline52">
<ul class="org-ul">
<li>compress/uncompress: .Z</li>
<li>gzip/gunzip: .gz</li>
<li>bzip2/bunzip2: .bz2</li>
<li>xz/unxz: .xz</li>
<li>zip/unzip: .zip</li>
<li>tar, cpio</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-3">
<h3 id="orgheadline53">gzip/gunzip</h3>
<div class="outline-text-3" id="text-orgheadline53">
<div class="org-src-container">

<pre class="src src-conf">gzip [OPTION]... FILE ...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#40664;&#35748;&#21387;&#32553;&#21518;&#20250;&#21024;&#38500;&#21407;&#25991;&#20214;</span>
  -d: &#35299;&#21387;&#32553;&#65292;&#30456;&#24403;&#20110;gunzip
  -c: &#23558;&#32467;&#26524;&#36755;&#20986;&#33267;&#26631;&#20934;&#36755;&#20986;, &#21487;&#29992;&#20110;&#37325;&#23450;&#21521;
  -NUM: &#25351;&#23450;&#21387;&#32553;&#27604;(&#40664;&#35748;&#26159;6)

zcat: &#19981;&#26174;&#24335;&#23637;&#24320;&#30340;&#21069;&#25552;&#19979;&#26597;&#30475;&#25991;&#26412;&#25991;&#20214;&#20869;&#23481;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-3">
<h3 id="orgheadline54">bzip2/bunzip2</h3>
<div class="outline-text-3" id="text-orgheadline54">
<div class="org-src-container">

<pre class="src src-conf">bzip2 [OPTION]... FILE ...
    -k: keep, &#20445;&#30041;&#21407;&#25991;&#20214;
    -d: &#35299;&#21387;&#32553;, &#30456;&#24403;&#20110;bunzip2
    -NUM: &#21387;&#32553;&#27604;(&#40664;&#35748;&#20026;6)

xzcat: &#19981;&#26174;&#24335;&#23637;&#24320;&#30340;&#21069;&#25552;&#19979;&#26597;&#30475;&#25991;&#26412;&#25991;&#20214;&#20869;&#23481;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline55" class="outline-3">
<h3 id="orgheadline55">xz/unxz</h3>
<div class="outline-text-3" id="text-orgheadline55">
<p>
压缩比高
</p>
<div class="org-src-container">

<pre class="src src-conf">xz [OPTION]... FILE ...
    -k: keep, &#20445;&#30041;&#21407;&#25991;&#20214;
    -d: &#35299;&#21387;&#32553;, &#30456;&#24403;&#20110;unxz
    -NUM: &#21387;&#32553;&#27604;(&#40664;&#35748;&#20026;6)

xzcat: &#19981;&#26174;&#24335;&#23637;&#24320;&#30340;&#21069;&#25552;&#19979;&#26597;&#30475;&#25991;&#26412;&#25991;&#20214;&#20869;&#23481;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-3">
<h3 id="orgheadline56">zip/unzip</h3>
<div class="outline-text-3" id="text-orgheadline56">
<p>
同时支持压缩和打包
</p>
<div class="org-src-container">

<pre class="src src-conf">zip [OPTION]... FILENAME DIRECTORY/*  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21387;&#32553;&#30446;&#24405;</span>
  -d: &#29992;&#20110;&#21024;&#38500;&#37324;&#36793;&#30340;&#25991;&#20214;
unzip FILENAME  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#35299;&#21387;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-3">
<h3 id="orgheadline57">tar</h3>
<div class="outline-text-3" id="text-orgheadline57">
<div class="org-src-container">

<pre class="src src-conf">tar [OPTION]... FILE
  -c: &#21019;&#24314;&#24402;&#26723;&#25991;&#20214;  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#19981;&#20250;&#21024;&#38500;&#21407;&#25991;&#20214;</span>
  -t: &#26597;&#30475;&#24402;&#26723;&#25991;&#20214;&#21015;&#34920;
  -x: &#23637;&#24320;&#24402;&#26723;&#25991;&#20214;

  -f FILENAME: &#25351;&#23450;&#24402;&#26723;&#25991;&#20214;
  -C PATH: &#25351;&#23450;&#23637;&#24320;&#30446;&#24405;(&#40664;&#35748;&#20026;&#24403;&#21069;&#30446;&#24405;)

  -z: gzip
  -j: bzip2
  -J: xz  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#21644;&#23637;&#24320;&#26102;&#21487;&#20197;&#30465;&#30053;</span>

tar -czf /PATH/FILE.tar.gz FILE...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21019;&#24314;&#24402;&#26723;&#25991;&#20214;</span>
tar -tf /PATH/FILE.tar.bz2  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#24402;&#26723;&#25991;&#20214;&#21015;&#34920;</span>
tar -xf /PATH/FILE.tar.xz -C /PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23637;&#24320;&#24402;&#26723;&#25991;&#20214;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline94" class="outline-2">
<h2 id="orgheadline94"><span class="section-number-2">6</span> Bash</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-orgheadline59" class="outline-3">
<h3 id="orgheadline59">命令历史</h3>
<div class="outline-text-3" id="text-orgheadline59">
<ul class="org-ul">
<li>登录shell时，会读取历史文件中记录下的命令: <code>~/.bash_history</code></li>
<li>登录shell后新执行的命令只会记录在缓存中，当用户退出时才会追加至命令历史文件中</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">history [NUM]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#21382;&#21490;&#20013;&#26368;&#36817;NUM&#26465;&#21629;&#20196;</span>
  -a: &#36861;&#21152;&#26032;&#25191;&#34892;&#30340;&#21629;&#20196;&#33267;&#21382;&#21490;&#25991;&#20214;&#20013;
  -d OFFSET: &#21024;&#38500;&#21382;&#21490;&#20013;&#25351;&#23450;&#30340;&#21629;&#20196;
  -c: &#28165;&#31354;&#21382;&#21490;&#21629;&#20196;
</pre>
</div>
<dl class="org-dl">
<dt>环境变量</dt><dd><ul class="org-ul">
<li>HISTSIZE: 命令历史记录的条数</li>
<li>HISTFILE: ~/.bash_history</li>
<li>HISTFILESIZE: 命令历史文件记录历史的条数</li>
<li>HISTCONTROL: 控制命令历史的记录方式
<ul class="org-ul">
<li>ignoredups(默认值): 忽略连续重复的指令</li>
<li>ignorespace: 忽略所有以空白开头的命令</li>
<li>ignoreboth: ignoredups, ignorespace</li>
</ul></li>
</ul></dd>

<dt>(no term)</dt><dd>修改环境变量: export 变量名="值"</dd>

<dt>快捷操作</dt><dd><ul class="org-ul">
<li>!#: 调用历史中第#条命令</li>
<li>!string: 调用历史中最近一个以string开头的命令</li>
<li>!!: 上条命令</li>
<li>!$: 调用上一条命令的最后一个参数(用于同个文件的操作)
<ul class="org-ul">
<li>也可以用 <code>ESC .</code> 来代替</li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline60" class="outline-3">
<h3 id="orgheadline60">命令或路径补全和展开</h3>
<div class="outline-text-3" id="text-orgheadline60">
<ul class="org-ul">
<li>直接补全: 用户给定的字符串只有一条惟一对应的命令或路径，则按TAB直接补全</li>
<li>补全列表: 对应的命令或路径不唯一，按两次TAB会给出列表</li>
<li>{}: 可承载一个以逗号分隔的列表，并将其展开为多个路径，可嵌套使用
<ul class="org-ul">
<li>/tmp/{a,b}_{x,y}</li>
<li>/tmp/{bin,sbin,usr/{bin,sbin}}</li>
</ul></li>
<li>{start..end}: 可以生成一个顺序列表, 但这种方式很占内存
<ul class="org-ul">
<li>user{1..3}: 相当于 <code>user1 user2 user3</code></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline61" class="outline-3">
<h3 id="orgheadline61">命令的执行结果</h3>
<div class="outline-text-3" id="text-orgheadline61">
<p>
bash使用特殊变量 <code>$?</code> 来保存最近一条命令的执行结果
</p>
<ul class="org-ul">
<li>0: 成功</li>
<li>1-255: 失败</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline62" class="outline-3">
<h3 id="orgheadline62">命令别名(alias)</h3>
<div class="outline-text-3" id="text-orgheadline62">
<div class="org-src-container">

<pre class="src src-conf">alias  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#24403;&#21069;shell&#36827;&#31243;&#25152;&#26377;&#21487;&#29992;&#30340;&#21629;&#20196;&#21035;&#21517;</span>
<span style="color: #FD971F;">alias NAME</span>=<span style="color: #E6DB74;">'VALUE'</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23450;&#20041;&#21629;&#20196;&#21035;&#21517;NAME</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#22914;&#26524;&#35201;&#27704;&#20037;&#29983;&#25928;&#38656;&#35201;&#20889;&#20837;bash&#37197;&#32622;&#25991;&#20214;&#20013;</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-conf">unalias [-a] name...
  -a: &#25764;&#38144;&#25152;&#26377;&#21035;&#21517;
</pre>
</div>
<ul class="org-ul">
<li>如果要忽略别名执行原命令的话，可使用 <code>\COMMAND</code></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline63" class="outline-3">
<h3 id="orgheadline63">glob</h3>
<div class="outline-text-3" id="text-orgheadline63">
<p>
bash中用于实现文件名“通配”
</p>
<dl class="org-dl">
<dt>通配符</dt><dd><ul class="org-ul">
<li>*: 任意长度的任意字符，包含空</li>
<li>?: 任意单个字符</li>
<li>[]: 匹配指定范围内的任意单个字符
<ul class="org-ul">
<li>[a-z]: 由于按照aAbB(根据locale和LC_COLLATE变量决定的)的排列，所以除Z外的字母都匹配</li>
</ul></li>
<li>[^]: 匹配制定范围外的任意单个字符</li>
</ul></dd>
<dt>专用字符集合</dt><dd><ul class="org-ul">
<li>[:digit:]: 任意数字</li>
<li>[:lower:]: 任意小写字母</li>
<li>[:upper:]: 任意大写字母</li>
<li>[:alpha:]: 任意大小写字母</li>
<li>[:alnum:]: 任意数字或字母</li>
<li>[:space:]:</li>
<li>[:punct:]: 标点符号</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline64" class="outline-3">
<h3 id="orgheadline64">bash的快捷键</h3>
<div class="outline-text-3" id="text-orgheadline64">
<ul class="org-ul">
<li>Ctrl+L: 清屏，相当于clear命令</li>
<li>Ctrl+A: 跳转至命令开始处</li>
<li>Ctrl+E: 跳转至命令结尾处</li>
<li>Ctrl+C: 取消前台进程命令的执行</li>
<li>Ctrl+U: 删除光标所在处至行首的所有内容</li>
<li>Ctrl+K: 删除光标所在处至行尾的所有内容</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline65" class="outline-3">
<h3 id="orgheadline65">I/O重定向及管道</h3>
<div class="outline-text-3" id="text-orgheadline65">
<ul class="org-ul">
<li>每个打开的文件都会有一个fd: file descripter(文件描述符)
<ul class="org-ul">
<li>标准输入: keyborad, 0</li>
<li>标准输出: monitor, 1</li>
<li>标准错误输出: monitor, 2</li>
</ul></li>
</ul>
</div>
<div id="outline-container-orgheadline66" class="outline-4">
<h4 id="orgheadline66">I/O重定向</h4>
<div class="outline-text-4" id="text-orgheadline66">
<p>
改变标准位置
</p>
<dl class="org-dl">
<dt>输出重定向</dt><dd><ul class="org-ul">
<li><p>
&gt;: 覆盖重定向标准输出
</p>
<pre class="example">
禁止将内容覆盖输出至已有文件中: set -C (恢复是 set +C )
&gt;|: 强制覆盖重定向
</pre></li>
<li>&gt;&gt;: 追加重定向标准输出</li>
<li>2&gt;: 覆盖重定向错误输出</li>
<li>2&gt;&gt;: 追加重定向错误输出</li>
<li>&amp;&gt;: 覆盖重定向合并标准输出和错误输出
<ul class="org-ul">
<li>也可以使用 <code>2&gt;&amp;1</code></li>
</ul></li>
<li>&amp;&gt;&gt;: 追加重定向合并标准输出和错误输出</li>
</ul></dd>
<dt>输入重定向</dt><dd><ul class="org-ul">
<li>&lt;file: 标准输入使用file</li>
<li><p>
&lt;&lt;EOF: 读取你的输入至EOF行
</p>

<div class="org-src-container">

<pre class="src src-conf">cat &gt;&gt; file &lt;&lt; EOF
</pre>
</div></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline67" class="outline-4">
<h4 id="orgheadline67">管道</h4>
<div class="outline-text-4" id="text-orgheadline67">
<p>
使用 <code>|</code> 来连接命令，前一个命令的标准输出当作后一个命令的输入
</p>
<div class="org-src-container">

<pre class="src src-conf">tee [OPTION]... [FILE]... <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23558;&#26631;&#20934;&#36755;&#20837;&#36755;&#20986;&#21040;&#26631;&#20934;&#36755;&#20986;&#21644;&#25991;&#20214;</span>
</pre>
</div>
<ul class="org-ul">
<li>/dev/null: 丢弃数据的设备</li>
<li>/dev/zero: 产生0的设备</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline68" class="outline-3">
<h3 id="orgheadline68">Shell脚本</h3>
<div class="outline-text-3" id="text-orgheadline68">
<ul class="org-ul">
<li>Shell编程: 过程式、解释执行</li>
<li>脚本文件要直接运行需要添加 <code>x</code> 权限，或直接运行解释器进行执行</li>
</ul>
</div>
<div id="outline-container-orgheadline69" class="outline-4">
<h4 id="orgheadline69">弱类型与强类型</h4>
<div class="outline-text-4" id="text-orgheadline69">
<ul class="org-ul">
<li>强类型: 定义变量时必须指定类型、参与运算必须符合类型要求；调用未声明变量会产生错误</li>
<li>弱类型: 无须指定类型，默认均为字符型；参与运算会自动进行隐式类型转换；变量无须事先定义可直接调用</li>
<li>bash是一种弱类型语言，把所有要存储的数据都当作字符进行，同时不支持浮点数</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline70" class="outline-4">
<h4 id="orgheadline70">shebang</h4>
<div class="outline-text-4" id="text-orgheadline70">
<ul class="org-ul">
<li>脚本文件第一行，即 #!/bin/bash</li>
<li>内核通过文件前几个字节的魔数(magic number)来识别文件类型然后打开</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline71" class="outline-4">
<h4 id="orgheadline71">脚本退出码</h4>
<div class="outline-text-4" id="text-orgheadline71">
<div class="org-src-container">

<pre class="src src-conf">exit [n]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#32456;&#27490;&#33050;&#26412;&#65292;&#36864;&#20986;&#30721;&#20026;n(&#40664;&#35748;&#20026;0)</span>
</pre>
</div>
<ul class="org-ul">
<li>如果未给脚本指定退出状态码，整个脚本的退出状态码取决于脚本中执行的最后一条命令的状态码</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline72" class="outline-4">
<h4 id="orgheadline72">用户交互</h4>
<div class="outline-text-4" id="text-orgheadline72">
<div class="org-src-container">

<pre class="src src-conf">read [option]... [name ...] 
    -p <span style="color: #E6DB74;">'PROMPT'</span>: &#26174;&#31034;&#20132;&#20114;&#20449;&#24687;
    -t TIMEOUT: &#31561;&#24453;&#26102;&#38388;
</pre>
</div>
<ul class="org-ul">
<li>read会对字符串以空格进行分隔来对位赋值，剩余部分会赋给最后一个参数</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73">选择执行</h4>
<div class="outline-text-4" id="text-orgheadline73">
<dl class="org-dl">
<dt>if</dt><dd><ul class="org-ul">
<li>if语句可以进行嵌套</li>
</ul>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">if</span> COMMAND1
<span style="color: #F92672;">then</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">COMMAND1&#25104;&#21151;&#21518;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
<span style="color: #F92672;">elif</span> COMMAND2; <span style="color: #F92672;">then</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21487;&#20197;&#20889;&#22312;&#19968;&#34892;</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">COMMAND1&#22833;&#36133;&#19988;COMMAND2&#25104;&#21151;&#21518;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
<span style="color: #F92672;">else</span>
    <span style="color: #75715E;"># </span><span style="color: #75715E;">COMMAND1&#21644;COMMAND2&#37117;&#22833;&#36133;&#21518;&#25191;&#34892;&#30340;&#20195;&#30721;</span>
<span style="color: #F92672;">fi</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">if&#32467;&#26463;&#26631;&#24535;</span>
</pre>
</div></dd>
<dt>case</dt><dd><div class="org-src-container">

<pre class="src src-shell"><span style="color: #F92672;">case</span> &#21464;&#37327;&#24341;&#29992;<span style="color: #F92672;"> in</span>
glob1)  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21487;&#20351;&#29992; glob &#39118;&#26684;&#36890;&#37197;&#31526;</span>
    &#20998;&#25903;1
    ;;
glob2|glob3)  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20351;&#29992;|&#26469;&#21305;&#37197;&#22810;&#20010;glob</span>
    &#20998;&#25903;2
    ;;
...
*<span style="color: #F8F8F2; background-color: #272822;">)</span>
    &#40664;&#35748;&#20998;&#25903;
    ;;
<span style="color: #F92672;">esac</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#21482;&#25191;&#34892;&#31532;&#19968;&#27425;&#25104;&#21151;&#21305;&#37197;&#30340;&#20998;&#25903;</span>
</pre>
</div></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74">循环执行</h4>
<div class="outline-text-4" id="text-orgheadline74">
<dl class="org-dl">
<dt>for</dt><dd><ul class="org-ul">
<li><p>
列表式
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">for</span> &#21464;&#37327;&#21517;<span style="color: #F92672;"> in</span> &#21015;&#34920;; <span style="color: #F92672;">do</span>
    &#24490;&#29615;&#20307;
<span style="color: #F92672;">done</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#20381;&#27425;&#23558;&#21015;&#34920;&#20013;&#30340;&#20803;&#32032;&#36171;&#20540;&#32473;"&#21464;&#37327;&#21517;"; &#27599;&#27425;&#36171;&#20540;&#21518;&#21363;&#25191;&#34892;&#19968;&#27425;&#24490;&#29615;&#20307;; &#30452;&#21040;&#21015;&#34920;&#20013;&#30340;&#20803;&#32032;&#32791;&#23613;&#65292;&#24490;&#29615;&#32467;&#26463;</span>
</pre>
</div>
<ul class="org-ul">
<li>列表生成方式
<ol class="org-ol">
<li>直接给出列表</li>
<li>整数列表
<ol class="org-ol">
<li>{start..end}</li>
<li>$(seq [start [step]] end)</li>
</ol></li>
<li>返回列表的命令</li>
<li>文件名通配glob, 会展开文件名列表</li>
<li>变量引用, 例如$@、$*</li>
</ol></li>
</ul></li>
<li><p>
C风格式
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">for</span> <span style="color: #AE81FF;">(</span><span style="color: #66D9EF;">(</span>&#25511;&#21046;&#21464;&#37327;&#21021;&#22987;&#21270;;&#26465;&#20214;&#21028;&#26029;&#34920;&#36798;&#24335;;&#25511;&#21046;&#21464;&#37327;&#30340;&#20462;&#27491;&#34920;&#36798;&#24335;<span style="color: #66D9EF;">)</span><span style="color: #AE81FF;">)</span>; <span style="color: #F92672;">do</span>
    &#24490;&#29615;&#20307;
<span style="color: #F92672;">done</span>
</pre>
</div>
<ul class="org-ul">
<li>控制变量初始化：仅在运行到循环代码段时执行一次</li>
<li>控制变量的修正表达式：每轮循环结束会先进行控制变量修正运算，而后再做条件判断</li>
</ul></li>
</ul></dd>

<dt>while</dt><dd><div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">while</span> COMMAND; <span style="color: #F92672;">do</span>
    &#24490;&#29615;&#20307;
<span style="color: #F92672;">done</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#24403;COMMAND&#20026;&#30495;&#30340;&#26102;&#20505;, &#37325;&#22797;&#25191;&#34892;&#24490;&#29615;&#20307;&#30452;&#33267;COMMAND&#20026;&#20551;</span>
</pre>
</div>
<ul class="org-ul">
<li><p>
特殊用法: 遍历文件的每一行
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">while </span><span style="color: #F92672;">read</span> line; <span style="color: #F92672;">do</span>
    &#24490;&#29615;&#20307;
<span style="color: #F92672;">done</span> &lt; FILE
</pre>
</div></li>
</ul></dd>

<dt>until</dt><dd><div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">until</span> COMMAND; <span style="color: #F92672;">do</span>
    &#24490;&#29615;&#20307;
<span style="color: #F92672;">done</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#24403;COMMAND&#20026;&#20551;&#30340;&#26102;&#20505;, &#37325;&#22797;&#25191;&#34892;&#24490;&#29615;&#20307;&#30452;&#33267;COMMAND&#20026;&#30495;</span>
</pre>
</div></dd>
<dt>循环控制语句</dt><dd><ul class="org-ul">
<li>continue [N]: 提前结束第N层的本轮循环，直接进入下一轮判断</li>
<li>break [N]: 提前结束第N层的循环
<ul class="org-ul">
<li>在死循环(while true)中使用break来控制循环</li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline75" class="outline-4">
<h4 id="orgheadline75">函数</h4>
<div class="outline-text-4" id="text-orgheadline75">
<ul class="org-ul">
<li>函数有两种风格的写法，只有被调用才会执行</li>
</ul>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">f_name</span> <span style="color: #AE81FF;">{</span>
    ...
<span style="color: #AE81FF;">}</span>

<span style="color: #A6E22E;">f_name</span><span style="color: #AE81FF;">()</span> <span style="color: #AE81FF;">{</span>
    ...
    <span style="color: #F92672;">return</span> <span style="color: #AE81FF;">0</span>   <span style="color: #75715E;"># </span><span style="color: #75715E;">&#29992;&#20110;&#32467;&#26463;&#20989;&#25968;&#24182;&#36820;&#22238;&#20989;&#25968;&#30340;&#25191;&#34892;&#32467;&#26524;&#65292;&#33509;&#30465;&#30053;&#21017;&#36820;&#22238;&#26368;&#21518;&#19968;&#20010;&#21629;&#20196;&#30340;&#32467;&#26524;&#65292;&#33539;&#22260;&#26159;0-255</span>
<span style="color: #AE81FF;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>函数的返回值
<ul class="org-ul">
<li>函数的执行结果返回值: 通过echo或print进行输出，使用命令引用来取得</li>
<li>函数退出状态码：通过return或最后一条命令的退出状态码</li>
</ul></li>
<li>在函数中，可以像脚本传递参数那样使用其参数
<ul class="org-ul">
<li>在函数中，不可使用外边脚本的参数</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline76" class="outline-4">
<h4 id="orgheadline76">检查和调试脚本</h4>
<div class="outline-text-4" id="text-orgheadline76">
<div class="org-src-container">

<pre class="src src-conf">bash -n SCRIPT  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26816;&#27979;&#33050;&#26412;&#20013;&#30340;&#35821;&#27861;&#38169;&#35823;</span>
bash -x SCRIPT  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#35843;&#35797;&#25191;&#34892;&#33050;&#26412;</span>
  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#34892;&#22836;+&#20195;&#34920;&#23618;&#25968;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline82" class="outline-3">
<h3 id="orgheadline82">bash变量</h3>
<div class="outline-text-3" id="text-orgheadline82">
</div><div id="outline-container-orgheadline77" class="outline-4">
<h4 id="orgheadline77">变量的生效范围</h4>
<div class="outline-text-4" id="text-orgheadline77">
<ul class="org-ul">
<li>本地变量: 生效范围为当前shell进程；对当前shell之外的其它shell进程，包括当前shell的子shell进程均无效</li>
<li>环境变量: 生效范围为当前shell进程及其子进程数</li>
<li>局部变量: 生效范围为当前shell进程中某代码片断(通常指函数)</li>
<li>位置变量: $0, $1, $2, &#x2026;来表示，用于让脚本在脚本代码中调用通过命令行传递给它的参数</li>
<li>特殊变量: $?, $*, $@, $#</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline78" class="outline-4">
<h4 id="orgheadline78">本地与环境变量</h4>
<div class="outline-text-4" id="text-orgheadline78">
<dl class="org-dl">
<dt>变量的赋值</dt><dd><div class="org-src-container">

<pre class="src src-conf"><span style="color: #75715E;"># </span><span style="color: #75715E;">&#26412;&#22320;&#21464;&#37327;</span>
<span style="color: #FD971F;">name</span>=<span style="color: #E6DB74;">"value: $val"</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#30452;&#25509;&#36171;&#20540;&#23383;&#31526;&#20018;</span>
<span style="color: #FD971F;">name</span>=`COMMAND`  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21629;&#20196;&#24341;&#29992;</span>
<span style="color: #FD971F;">name</span>=$(COMMAND)  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21629;&#20196;&#24341;&#29992;</span>

<span style="color: #75715E;"># </span><span style="color: #75715E;">&#29615;&#22659;&#21464;&#37327;</span>
<span style="color: #FD971F;">export name</span>=VALUE
<span style="color: #FD971F;">declare -x name</span>=VALUE
</pre>
</div></dd>

<dt>变量引用</dt><dd><ul class="org-ul">
<li>变量引用方式: $name, ${name}</li>
<li>字符串中的变量引用
<ul class="org-ul">
<li>"": 弱引用，其中的变量引用会被替换为变量值</li>
<li>'': 强引用，其中的变量引用不会被替换为变量值，而保持原字符串</li>
</ul></li>
</ul></dd>

<dt>相关命令</dt><dd><div class="org-src-container">

<pre class="src src-conf">set  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#23450;&#20041;&#30340;&#25152;&#26377;&#21464;&#37327;</span>
export  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#25152;&#26377;&#29615;&#22659;&#21464;&#37327;</span>
env  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#25152;&#26377;&#29615;&#22659;&#21464;&#37327;</span>
printenv   <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;&#25152;&#26377;&#29615;&#22659;&#21464;&#37327;</span>

unset name  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#38144;&#27585;&#21464;&#37327;</span>
</pre>
</div></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79">局部变量</h4>
<div class="outline-text-4" id="text-orgheadline79">
<p>
在函数中定义局部变量，函数结束的时候该变量会被销毁
</p>
<div class="org-src-container">

<pre class="src src-shell"><span style="color: #F92672;">function</span> <span style="color: #A6E22E;">f_name</span> <span style="color: #AE81FF;">{</span>
    <span style="color: #F92672;">local</span> <span style="color: #FD971F;">NAME</span>=VALUE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#35813;&#21464;&#37327;&#21482;&#22312;&#20989;&#25968;&#20869;&#29983;&#25928;</span>
<span style="color: #AE81FF;">}</span>
</pre>
</div>
<ul class="org-ul">
<li>如果函数中有局部变量，其名称本地变量相同，则本地变量在函数内会被隐藏</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline80" class="outline-4">
<h4 id="orgheadline80">只读变量</h4>
<div class="outline-text-4" id="text-orgheadline80">
<ul class="org-ul">
<li>只读变量不能被修改或销毁</li>
<li>只读变量可以声明为本地变量或环境变量，也可以将已有的变量转换为只读变量</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">readonly name
declare -r name
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline81" class="outline-4">
<h4 id="orgheadline81">位置变量</h4>
<div class="outline-text-4" id="text-orgheadline81">
<ul class="org-ul">
<li>在脚本代码中调用通过命令行传递给脚本的参数
<ul class="org-ul">
<li>$1, $2, &#x2026;: 对应调用的第n个参数</li>
<li>$0: 命令本身</li>
<li>$*: 传递给脚本的所有参数(用IFS分隔符分割的一个字符串)</li>
<li>$@: 传递给脚本的所有参数(每个参数都是独立的列表)</li>
<li>$#: 传递给脚本的参数的个数</li>
</ul></li>

<li id="相关命令"><div class="org-src-container">

<pre class="src src-conf">shift [n]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21442;&#25968;&#21024;&#38500;&#21069;&#38754;n&#20010;&#65292;&#20250;&#24433;&#21709;&#25152;&#26377;&#20301;&#32622;&#21464;&#37327;</span>
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline85" class="outline-3">
<h3 id="orgheadline85">bash中的算术计算</h3>
<div class="outline-text-3" id="text-orgheadline85">
</div><div id="outline-container-orgheadline83" class="outline-4">
<h4 id="orgheadline83">计算命令</h4>
<div class="outline-text-4" id="text-orgheadline83">
<div class="org-src-container">

<pre class="src src-conf"><span style="color: #FD971F;">declare -i name</span>=NUM  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23450;&#20041;name&#20026;&#25972;&#24418;&#25968;&#25454;, &#21017;&#21518;&#36793;&#30340;&#36171;&#20540;&#35745;&#31639;&#20013;&#30340;let&#21487;&#20197;&#30465;&#30053;</span>
<span style="color: #FD971F;">let var</span>=EXPRESSION
<span style="color: #FD971F;">var</span>=$[EXPRESSION]
<span style="color: #FD971F;">var</span>=$((EXPRESSION))
<span style="color: #FD971F;">var</span>=$(expr arg1 arg2 arg3)  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26576;&#20123;&#31526;&#21495;&#38656;&#35201;&#36827;&#34892;&#36716;&#20041;</span>
</pre>
</div>
<ul class="org-ul">
<li>bash有内建的随机数生成器: $RANDOM</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline84" class="outline-4">
<h4 id="orgheadline84">运算符号</h4>
<div class="outline-text-4" id="text-orgheadline84">
<dl class="org-dl">
<dt>基本运算符号</dt><dd>+, -, *, /, %, **</dd>
<dt>增强型赋值</dt><dd>+=, -=, *=, /=, %=</dd>

<dt>自增与自减</dt><dd>var++, var&#x2013;</dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgheadline89" class="outline-3">
<h3 id="orgheadline89">bash的条件测试</h3>
<div class="outline-text-3" id="text-orgheadline89">
</div><div id="outline-container-orgheadline86" class="outline-4">
<h4 id="orgheadline86">测试命令</h4>
<div class="outline-text-4" id="text-orgheadline86">
<div class="org-src-container">

<pre class="src src-shell">test EXPRESSION
<span style="color: #AE81FF;">[</span> EXPRESSION <span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">EXPRESSION&#21069;&#21518;&#24517;&#39035;&#26377;&#31354;&#30333;&#23383;&#31526;</span>
<span style="color: #AE81FF;">[</span><span style="color: #66D9EF;">[</span> EXPRESSION <span style="color: #66D9EF;">]</span><span style="color: #AE81FF;">]</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline87" class="outline-4">
<h4 id="orgheadline87">测试符号</h4>
<div class="outline-text-4" id="text-orgheadline87">
<dl class="org-dl">
<dt>数值测试</dt><dd><ul class="org-ul">
<li>-gt: greater than</li>
<li>-ge: greater equal</li>
<li>-eq: equal</li>
<li>-ne: not equal</li>
<li>-lt: less than</li>
<li>-le: less equal</li>
</ul></dd>
<dt>字符串测试</dt><dd><ul class="org-ul">
<li>==: 等于</li>
<li>&gt;: 大于</li>
<li>&lt;: 小于</li>
<li>!=: 不等于</li>
<li>=~: 左侧字符串是否能够被右侧的PATTERN(不需要用引号)部分匹配

<ul class="org-ul">
<li>此表达式用于 <code>[[  ]]</code> 中</li>
</ul></li>
<li>-z "STRING": 测试字符串是否为空，空则为真，不空则为假</li>
<li>-n "STRING": 测试字符串是否不空，不空则为真，空则为假</li>
<li>注意: 用于字符串比较时的用到的操作数都应该使用引号</li>
</ul></dd>
<dt>文件测试</dt><dd><ul class="org-ul">
<li>存在性测试
<ul class="org-ul">
<li>-e FILE: 文件存在性测试，存在为真，否则为假</li>
</ul></li>
<li>类型测试
<ul class="org-ul">
<li>-b FILE: 是否存在且为块设备文件</li>
<li>-c FILE: 是否存在且为字符设备文件</li>
<li>-d FILE: 是否存在且为目录文件</li>
<li>-f FILE: 是否存在且为普通文件</li>
<li>-p FILE: 是否存在且为命名管道文件</li>
<li>-L FILE: 是否存在且为符号链接文件</li>
<li>-S FILE: 是否存在且为套接字文件</li>
</ul></li>
<li>文件权限测试
<ul class="org-ul">
<li>-r FILE: 是否存在且可读</li>
<li>-w FILE: 是否存在且可写</li>
<li>-x FILE: 是否存在且可执行</li>
<li>-O FILE: 当前有效用户是否为文件属主</li>
<li>-G FILE: 当前有效用户是否为文件属组</li>
<li>权限测试对root用户来说表现奇怪</li>
</ul></li>
<li>文件特殊权限测试
<ul class="org-ul">
<li>-g FILE: 是否存在且拥有sgid权限</li>
<li>-u FILE: 是否存在且拥有suid权限</li>
<li>-k FILE: 是否存在且拥有sticky权限</li>
</ul></li>
<li>文件其他测试
<ul class="org-ul">
<li>-s FILE: 是否存且非空</li>
<li>-t fd: 文件描述符fd是否已经打开且与某终端相关</li>
<li>-N FILE: 文件自动上一次被读取之后是否被修改过</li>
</ul></li>
<li>双目测试
<ul class="org-ul">
<li>FILE1 -ef FILE2: FILE1与FILE2是否指向同一个设备上的相同inode</li>
<li>FILE1 -nt FILE2: FILE1是否新于FILE2</li>
<li>FILE1 -ot FILE2: FILE1是否旧于FILE2</li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline88" class="outline-4">
<h4 id="orgheadline88">组合条件</h4>
<div class="outline-text-4" id="text-orgheadline88">
<dl class="org-dl">
<dt>命令组合</dt><dd><ul class="org-ul">
<li><code>COMMAND &amp;&amp; COMMAND</code>: 第一个命令结果为false的话，则不会运行下一个</li>
<li><code>COMMAND || COMMAND</code>: 第一个命令结果为true的话，则不会运行下一个</li>
<li><code>! COMMAND</code>: 将后边所接的命令结果取反</li>
</ul></dd>
<dt>条件组合</dt><dd><ul class="org-ul">
<li><code>EXPRESSION -a EXPRESSION</code>: 与</li>
<li><code>EXPRESSION -o EXPRESSION</code>: 或</li>
<li><code>! \(EXPRESSION\)</code>: 非</li>
</ul></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-3">
<h3 id="orgheadline93">bash的配置文件</h3>
<div class="outline-text-3" id="text-orgheadline93">
</div><div id="outline-container-orgheadline90" class="outline-4">
<h4 id="orgheadline90">配置文件的类型</h4>
<div class="outline-text-4" id="text-orgheadline90">
<dl class="org-dl">
<dt>按生效范围划分</dt><dd><ul class="org-ul">
<li>全局配置: /etc/profile, /etc/profile.d/*.sh, /etc/bashrc</li>

<li>个人配置: ~/.bash_profile, ~/.bashrc</li>
</ul></dd>
<dt>按功能划分</dt><dd><ul class="org-ul">
<li>profile类: 为交互式登录的shell提供配置，用于定义环境变量和执行脚本</li>
<li>bashrc类: 为非交互式登录的shell提供配置，用于定义本地变量和命令别名</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline91" class="outline-4">
<h4 id="orgheadline91">shell登录过程</h4>
<div class="outline-text-4" id="text-orgheadline91">
<dl class="org-dl">
<dt>交互式登录</dt><dd><ul class="org-ul">
<li>直接通过终端输入账号密码登录</li>
<li>使用 <code>su - NAME</code> 切换用户</li>
<li>读取配置文件: <code>/etc/profile -&gt; /etc/profile.d/*.sh -&gt; ~/.bash_profile -&gt; ~/.bashrc -&gt; /etc/bash</code></li>
</ul></dd>
<dt>非交互式登录</dt><dd><ul class="org-ul">
<li>使用 <code>su NAME</code> 切换用户</li>
<li>图形界面下打开的终端</li>
<li>执行脚本的时候</li>
<li>读取配置文件: ~/.bashrc -&gt; /etc/bashrc -&gt; /etc/profile.d/*.sh</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline92" class="outline-4">
<h4 id="orgheadline92">载入配置文件的方式</h4>
<div class="outline-text-4" id="text-orgheadline92">
<ol class="org-ol">
<li>重新启动shell进程</li>
<li>使用source或.命令载入配置</li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline126" class="outline-2">
<h2 id="orgheadline126"><span class="section-number-2">7</span> 用户和组</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-orgheadline95" class="outline-3">
<h3 id="orgheadline95">资源分派</h3>
<div class="outline-text-3" id="text-orgheadline95">
<ol class="org-ol">
<li>Authentication: 认证，表明你能进入系统
<ul class="org-ul">
<li>token: 口令</li>
<li>identity: 用户名和密码</li>
</ul></li>
<li>Authorization: 授权，表明你有权限执行某些操作
<ul class="org-ul">
<li>进程所能够访问的所有资源的权限取决于进程的发起者的身份</li>
</ul></li>
<li>Accouting: 审计，验证你操作的合理性</li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline96" class="outline-3">
<h3 id="orgheadline96">用户: UID</h3>
<div class="outline-text-3" id="text-orgheadline96">
<ul class="org-ul">
<li>管理员: root, 0</li>
<li>普通用户: 1-65535(2^16)
<ul class="org-ul">
<li>系统用户: 1-499/999
<ul class="org-ul">
<li>用于对守护进程获取资源进行权限分配</li>
</ul></li>
<li>非系统用户: 500/1000+</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline97" class="outline-3">
<h3 id="orgheadline97">组: GID</h3>
<div class="outline-text-3" id="text-orgheadline97">
<ul class="org-ul">
<li>管理员组: root, 0</li>
<li>普通组
<ul class="org-ul">
<li>系统组: 1-499/999</li>
<li>普通组: 500/1000+</li>
</ul></li>
<li>用户的组的类别
<ul class="org-ul">
<li>用户的基本组: 组名同用户名，且仅包含一个用户，即私有组</li>
<li>用户的附加组(额外组)</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline98" class="outline-3">
<h3 id="orgheadline98">配置文件</h3>
<div class="outline-text-3" id="text-orgheadline98">
<dl class="org-dl">
<dt>/etc/passwd</dt><dd><ul class="org-ul">
<li>用户及其属性信息</li>
<li>name:password:UID:GID:GECOS:directory:shell</li>
<li>用户名:x:UID:GID:完整信息:主目录:默认shell</li>
</ul></dd>
<dt>/etc/group</dt><dd><ul class="org-ul">
<li>组及其属性信息</li>
<li>group_name:password:GID:user_list</li>
<li>组名:x:GID:以当前组为附加组的用户列表(分隔符为逗号)</li>
</ul></dd>
<dt>/etc/shadow</dt><dd><ul class="org-ul">
<li>用户名:加密密码:最近一次更改密码的日期:密码最小使用期限:密码最大使用期限:密码警告时间段:密码禁用期:账户过期日期:保留字段</li>
<li>加密密码: 添加随机字符串后，进行sha512单向加密，初始的条件的微小改变，将会引起结果的巨大改变
<ul class="org-ul">
<li>若密码为 <code>!!</code> 则为空密码</li>
</ul></li>
<li>用户名密码期限: 用户未修改密码时间到达密码警告时间段则会收到通知，到达密码最大使用期限会进入密码禁用期，若在这段时期没有登录的话，账号会被禁用(过期)</li>
</ul></dd>
<dt>/etc/gshadow</dt><dd><ul class="org-ul">
<li>组密码及其相关属性</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline114" class="outline-3">
<h3 id="orgheadline114">用户与组相关命令</h3>
<div class="outline-text-3" id="text-orgheadline114">
</div><div id="outline-container-orgheadline99" class="outline-4">
<h4 id="orgheadline99">查看用户信息: id</h4>
<div class="outline-text-4" id="text-orgheadline99">
<p>
id能够用于判断用户是否存在
</p>
<div class="org-src-container">

<pre class="src src-conf">id [OPTION]... [USER]
  -u: UID
  -g: GID
  -G: &#26174;&#31034;&#25152;&#26377;&#32452;
  -n: &#37197;&#21512;&#20854;&#20182;&#36873;&#39033;&#65292;&#26174;&#31034;&#21517;&#31216;&#32780;&#19981;&#26159;&#25968;&#23383;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline100" class="outline-4">
<h4 id="orgheadline100">su</h4>
<div class="outline-text-4" id="text-orgheadline100">
<p>
切换用户或以其他用户身份执行命令
</p>
<div class="org-src-container">

<pre class="src src-conf">su user     <span style="color: #75715E;"># </span><span style="color: #75715E;">&#38750;&#30331;&#24405;&#24335;&#20999;&#25442;&#65292;&#21363;&#19981;&#20250;&#35835;&#21462;&#30446;&#26631;&#29992;&#25143;&#30340;&#37197;&#32622;&#25991;&#20214;</span>
su - user   <span style="color: #75715E;"># </span><span style="color: #75715E;">&#30331;&#24405;&#24335;&#20999;&#25442;&#65292;&#20250;&#35835;&#21462;&#30446;&#26631;&#29992;&#25143;&#30340;&#37197;&#32622;&#25991;&#20214;&#65292;&#23436;&#20840;&#20999;&#25442;</span>
su [-] UserName -c <span style="color: #E6DB74;">'COMMAND'</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20197;&#20854;&#20182;&#29992;&#25143;&#30340;&#36523;&#20221;&#25191;&#34892;&#21629;&#20196;&#65292;&#19981;&#20999;&#25442;&#29992;&#25143;</span>
</pre>
</div>
<ul class="org-ul">
<li>root切换至其他用户无须密码，而非root用户切换时需要密码</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline101" class="outline-4">
<h4 id="orgheadline101">newgrp</h4>
<div class="outline-text-4" id="text-orgheadline101">
<p>
临时切换基本组
</p>
<div class="org-src-container">

<pre class="src src-conf">newgrp GROUP
<span style="color: #75715E;"># </span><span style="color: #75715E;">&#22914;&#26524;&#29992;&#25143;&#26412;&#19981;&#23646;&#20110;GROUP&#65292;&#21017;&#38656;&#35201;&#23494;&#30721;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline107" class="outline-4">
<h4 id="orgheadline107">用户相关</h4>
<div class="outline-text-4" id="text-orgheadline107">
</div><ul class="org-ul"><li><a id="orgheadline102"></a>useradd<br  /><div class="outline-text-5" id="text-orgheadline102">
<p>
创建用户
</p>
<div class="org-src-container">

<pre class="src src-conf">useradd [OPTION]... NAME
  -u UID: &#33539;&#22260;&#26159;[UID_MIN, UID_MAX], &#23450;&#20041;&#22312;/etc/login.defs
  -g GID: &#25351;&#26126;&#29992;&#25143;&#25152;&#23646;&#22522;&#26412;&#32452;&#65292;&#21487;&#20026;&#32452;&#21517;
  -c <span style="color: #E6DB74;">"COMMENT"</span>: &#29992;&#25143;&#30340;&#27880;&#37322;&#20449;&#24687;(GECOS)
  -m: &#21019;&#24314;HOME&#30446;&#24405;&#65292;&#24182;&#22797;&#21046;/etc/skel&#20869;&#25991;&#20214;&#21040;&#36825;(&#40664;&#35748;)
  -p PASSWORD: &#20026;&#29992;&#25143;&#25351;&#23450;&#23494;&#30721;
  -d /PATH/TO/HOME_DIR: &#20197;&#25351;&#23450;&#30340;&#36335;&#24452;&#20026;&#23478;&#30446;&#24405;
  -s SHELL: &#25351;&#26126;&#29992;&#25143;&#30340;&#40664;&#35748;shell&#31243;&#24207;&#65292;&#21487;&#29992;&#21015;&#34920;&#22312;/etc/shells&#25991;&#20214;&#20013;
  -G GROUP1[,GROUP2,...[,GROUPN]]: &#20026;&#29992;&#25143;&#25351;&#26126;&#38468;&#21152;&#32452;&#65307;&#32452;&#24517;&#39035;&#20107;&#20808;&#23384;&#22312;
  -r: &#21019;&#24314;&#31995;&#32479;&#29992;&#25143;
</pre>
</div>
<ul class="org-ul">
<li><p>
默认值设定在 <code>/etc/default/useradd</code> 文件中
</p>
<div class="org-src-container">

<pre class="src src-conf">useradd -D  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;useradd&#40664;&#35748;&#20540;</span>
useradd -D [OPTION]...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;useradd&#40664;&#35748;&#20540;</span>
</pre>
</div></li>
</ul>
</div></li>
<li><a id="orgheadline103"></a>usermod<br  /><div class="outline-text-5" id="text-orgheadline103">
<p>
修改用户属性和过期日期
</p>
<div class="org-src-container">

<pre class="src src-conf">usermod [OPTION] NAME
  -u UID: &#26032;UID
  -g GID: &#26032;&#22522;&#26412;&#32452;
  -G GROUP1[,GROUP2,...[,GROUPN]]: &#26032;&#38468;&#21152;&#32452;&#65292;&#21407;&#26469;&#30340;&#38468;&#21152;&#32452;&#23558;&#20250;&#34987;&#35206;&#30422;
    -a: &#20445;&#30041;&#21407;&#26377;&#30340;&#38468;&#21152;&#32452;
  -s SHELL: &#26032;&#30340;&#40664;&#35748;SHELL
  -c <span style="color: #E6DB74;">'COMMENT'</span>: &#26032;&#30340;&#27880;&#37322;&#20449;&#24687;
  -d HOME: &#26032;&#30340;&#23478;&#30446;&#24405;&#65292;&#21407;&#26377;&#23478;&#30446;&#24405;&#20013;&#30340;&#25991;&#20214;&#19981;&#20250;&#21516;&#26102;&#31227;&#21160;&#33267;&#26032;&#30340;&#23478;&#30446;&#24405;
    -m: &#31227;&#21160;&#21407;&#26377;&#23478;&#30446;&#24405;&#20013;&#30340;&#25991;&#20214;
  -l login_name: &#26032;&#30340;&#21517;&#23383;

  -L: lock&#25351;&#23450;&#29992;&#25143;(&#22312;&#21152;&#23494;&#23494;&#30721;&#21069;&#21152; !)
  -U: unlock&#25351;&#23450;&#29992;&#25143;
  -e YYYY-MM-DD: &#25351;&#26126;&#29992;&#25143;&#36134;&#21495;&#36807;&#26399;&#26085;&#26399;
</pre>
</div>
</div></li>
<li><a id="orgheadline104"></a>passwd<br  /><div class="outline-text-5" id="text-orgheadline104">
<p>
添加或修改密码及密码期限相关内容
</p>
<div class="org-src-container">

<pre class="src src-conf">passwd  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;&#33258;&#24049;&#30340;&#23494;&#30721;</span>
passwd [OPTIONS] UserName  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;&#25351;&#23450;&#29992;&#25143;&#30340;&#23494;&#30721;&#65292;&#20165;root&#29992;&#25143;&#21487;&#29992;</span>
  -l: &#38145;&#23450;&#25351;&#23450;&#29992;&#25143;
  -u: &#35299;&#38145;&#25351;&#23450;&#29992;&#25143;

  -n mindays: &#25351;&#23450;&#26368;&#30701;&#20351;&#29992;&#26399;&#38480;
  -x maxdays: &#26368;&#22823;&#20351;&#29992;&#26399;&#38480;
  -w warndays: &#25552;&#21069;&#22810;&#23569;&#22825;&#24320;&#22987;&#35686;&#21578;
  -i inactivedays: &#23494;&#30721;&#31105;&#29992;&#26399;

  --stdin: &#20174;&#26631;&#20934;&#36755;&#20837;&#25509;&#25910;&#29992;&#25143;&#23494;&#30721;
</pre>
</div>
</div></li>
<li><a id="orgheadline105"></a>chage<br  /><div class="outline-text-5" id="text-orgheadline105">
<p>
修改用户日期相关内容
</p>
<div class="org-src-container">

<pre class="src src-conf">chage [OPTION]... NAME
  -d LAST_DAY
  -E, --expiredate EXPIRE_DATE
  -I, --inactive INACTIVE
  -m, --mindays MIN_DAYS
  -M, --maxdays MAX_DAYS
  -W, --warndays WARN_DAYS
</pre>
</div>
</div></li>
<li><a id="orgheadline106"></a>userdel<br  /><div class="outline-text-5" id="text-orgheadline106">
<p>
删除用户
</p>
<div class="org-src-container">

<pre class="src src-conf">userdel [OPTION]... NAME
  -r: &#21024;&#38500;&#29992;&#25143;&#23478;&#30446;&#24405;
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-orgheadline112" class="outline-4">
<h4 id="orgheadline112">组相关</h4>
<div class="outline-text-4" id="text-orgheadline112">
</div><ul class="org-ul"><li><a id="orgheadline108"></a>groupadd<br  /><div class="outline-text-5" id="text-orgheadline108">
<p>
创建组
</p>
<div class="org-src-container">

<pre class="src src-conf">groupadd [OPTION]... group_name
  -g GID: &#33539;&#22260;&#26159;[GID_MIN, GID_MAX]
  -r: &#21019;&#24314;&#31995;&#32479;&#32452;
</pre>
</div>
</div></li>
<li><a id="orgheadline109"></a>groupmod<br  /><div class="outline-text-5" id="text-orgheadline109">
<p>
修改组属性
</p>
<div class="org-src-container">

<pre class="src src-conf">groupmod [OPTION]... group
  -n group_name: &#26032;&#21517;&#23383;
  -g GID: &#26032;&#30340;GID
</pre>
</div>
</div></li>
<li><a id="orgheadline110"></a>gpasswd<br  /><div class="outline-text-5" id="text-orgheadline110">
<p>
修改组密码和添加删除组员
</p>
<div class="org-src-container">

<pre class="src src-conf">gpasswd [OPTION] GROUP
  -a user: &#23558;user&#28155;&#21152;&#33267;&#25351;&#23450;&#32452;&#20013;
  -d user: &#21024;&#38500;&#29992;&#25143;user&#30340;&#20197;&#24403;&#21069;&#32452;&#20026;&#32452;&#21517;&#30340;&#38468;&#21152;&#32452;
  -A user1,user2,...: &#35774;&#32622;&#32676;&#32452;&#31649;&#29702;&#21592;&#65292;&#32676;&#32452;&#31649;&#29702;&#21592;&#21487;&#20197;&#31649;&#29702;&#21738;&#20123;&#24080;&#21495;&#21487;&#20197;&#21152;&#20837;/&#31227;&#20986;&#35813;&#32676;&#32452;
</pre>
</div>
</div></li>
<li><a id="orgheadline111"></a>groupdel<br  /><div class="outline-text-5" id="text-orgheadline111">
<p>
删除组
</p>
<div class="org-src-container">

<pre class="src src-conf">groupdel GROUP
</pre>
</div>
</div></li></ul>
</div>
<div id="outline-container-orgheadline113" class="outline-4">
<h4 id="orgheadline113">其他</h4>
<div class="outline-text-4" id="text-orgheadline113">
<dl class="org-dl">
<dt>pwck</dt><dd>检查密码文件的完整性</dd>
<dt>chfn</dt><dd>设置用户详细信息</dd>
<dt>finger</dt><dd>查看用户详细信息</dd>
<dt>chsh</dt><dd>改变用户默认shell</dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-orgheadline125" class="outline-3">
<h3 id="orgheadline125">文件权限管理</h3>
<div class="outline-text-3" id="text-orgheadline125">
</div><div id="outline-container-orgheadline115" class="outline-4">
<h4 id="orgheadline115">三类对象</h4>
<div class="outline-text-4" id="text-orgheadline115">
<ul class="org-ul">
<li>owner: 属主 u</li>
<li>group: 属组 g</li>
<li>other: 其他 o</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline116" class="outline-4">
<h4 id="orgheadline116">基本权限</h4>
<div class="outline-text-4" id="text-orgheadline116">
<ul class="org-ul">
<li>r(4): Readable</li>
<li>w(2): Writable</li>
<li>x(1): eXcutable</li>
</ul>


<dl class="org-dl">
<dt>文件</dt><dd><ul class="org-ul">
<li>r: 可使用文件查看类工具获取其内容</li>
<li>w: 可修改其内容</li>
<li>x: 可以把此文件提请内核启动为一个进程</li>
</ul></dd>
<dt>目录</dt><dd><ul class="org-ul">
<li>r: 可以使用ls查看此目录中文件列表</li>
<li>w: 可在此目录中创建文件，也可删除此目录中的文件</li>
<li>x: 无法执行该目录下的任何命令，包括创建和删除文件</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline121" class="outline-4">
<h4 id="orgheadline121">特殊权限</h4>
<div class="outline-text-4" id="text-orgheadline121">
</div><ul class="org-ul"><li><a id="orgheadline117"></a>SUID(4)<br  /><div class="outline-text-5" id="text-orgheadline117">
<p>
默认情况下，启动为进程之后，其进程的属主为发起者，进程的属组为发起者所属的组；而启动带SUID的程序文件时，其进程的属主为原程序文件的属主
</p>
<div class="org-src-container">

<pre class="src src-conf">chmod u+s FILE
chmod u-s FILE
</pre>
</div>
</div></li>
<li><a id="orgheadline118"></a>SGID(2)<br  /><div class="outline-text-5" id="text-orgheadline118">
<p>
默认情况下，用户创建文件时，其属组为此用户所属的基本组；一旦某目录被设定了SGID，则对此目录有写权限的用户在此目录中创建的文件所属的组为此目录的属组
</p>
<div class="org-src-container">

<pre class="src src-conf">chmod g+s FILE
chmod g-s FILE
</pre>
</div>
<ul class="org-ul">
<li>经常用于团队协作，因为创建的文件后其他人不会被当作other</li>
<li>如果对可执行文件设定SGID，则文件执行后的进程属组是文件的属组</li>
</ul>
</div></li>
<li><a id="orgheadline119"></a>Sticky(1)<br  /><div class="outline-text-5" id="text-orgheadline119">
<p>
对于一个多人可写的目录，如果设置了sticky，则每个用户仅能删除自己的文件；如果对文件设定，则该文件只能由属主执行删除和移动
</p>
<div class="org-src-container">

<pre class="src src-conf">chmod o+t FILE
chmod o-t FILE
</pre>
</div>
<ul class="org-ul">
<li><code>/tmp</code> 就有Sticky权限</li>
</ul>
</div></li>
<li><a id="orgheadline120"></a>权限位映射:<br  /><div class="outline-text-5" id="text-orgheadline120">
<ul class="org-ul">
<li>SUID: user, 占据属主的执行权限位
<ul class="org-ul">
<li>s: 属主拥有x权限</li>
<li>S: 属主没有x权限</li>
</ul></li>
<li>SGID: group,  占据group的执行权限位
<ul class="org-ul">
<li>s: group拥有x权限</li>
<li>S: group没有x权限</li>
</ul></li>
<li>Sticky: other, 占据ohter的执行权限位
<ul class="org-ul">
<li>t: other拥有x权限</li>
<li>T: other没有x权限</li>
</ul></li>
</ul>
</div></li></ul>
</div>

<div id="outline-container-orgheadline122" class="outline-4">
<h4 id="orgheadline122">修改文件权限: chmod</h4>
<div class="outline-text-4" id="text-orgheadline122">
<div class="org-src-container">

<pre class="src src-conf">chmod [OPTION]... MODE FILE...
  -R: &#36882;&#24402;&#20462;&#25913;&#26435;&#38480;
  MODE: 
    - &#21487;&#20351;&#29992;&#25968;&#23383;&#26435;&#38480;&#65292;&#22914;4755(&#26368;&#24038;&#36793;&#19968;&#20301;&#26159;&#29305;&#27530;&#26435;&#38480;&#65292;&#21487;&#20197;&#19981;&#20889;)
    <span style="color: #FD971F;">- &#21487;&#20462;&#25913;&#19968;&#31867;&#29992;&#25143;&#30340;&#26435;&#38480;&#65292;&#22914; u</span>=rwx,g+w,o-rwx,a-x

<span style="color: #FD971F;">chmod [OPTION]... --reference</span>=RFILE FILE...
    &#21442;&#32771;RFILE&#25991;&#20214;&#30340;&#26435;&#38480;&#65292;&#23558;FILE&#30340;&#20462;&#25913;&#20026;&#21516;RFILE&#19968;&#26679;&#30340;&#26435;&#38480;
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline123" class="outline-4">
<h4 id="orgheadline123">修改文件的属主和属组</h4>
<div class="outline-text-4" id="text-orgheadline123">
<ul class="org-ul">
<li>仅root可修改</li>
</ul>


<dl class="org-dl">
<dt>修改属主: chown</dt><dd><div class="org-src-container">

<pre class="src src-conf">chown [OPTION]... [OWNER][:[GROUP]] FILE...
<span style="color: #FD971F;">chown [OPTION]... --reference</span>=RFILE FILE...
  -R: &#30446;&#24405;&#36882;&#24402;&#20462;&#25913;
</pre>
</div>
<ul class="org-ul">
<li>chown也可只改属组，即不写OWNER</li>
</ul></dd>
<dt>修改属组: chgrp</dt><dd><div class="org-src-container">

<pre class="src src-conf">chgrp [OPTION]... GROUP FILE...
<span style="color: #FD971F;">chgrp [OPTION]... --reference</span>=RFILE FILE...
  -R: &#30446;&#24405;&#36882;&#24402;&#20462;&#25913;
</pre>
</div></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline124" class="outline-4">
<h4 id="orgheadline124">文件遮罩码: umask</h4>
<div class="outline-text-4" id="text-orgheadline124">
<ul class="org-ul">
<li>创建文件时，文件的权限是 666-umask</li>
<li>创建目录时，目录的权限是 777-umask</li>
</ul>

<div class="org-src-container">

<pre class="src src-conf">umask  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#30475;umask</span>
umask num  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#35774;&#32622;umask&#65292;&#20165;&#23545;&#24403;&#21069;shell&#26377;&#25928;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline130" class="outline-2">
<h2 id="orgheadline130"><span class="section-number-2">8</span> 正则表达式</h2>
<div class="outline-text-2" id="text-8">
<p>
REGEXP由一类特殊字符及文本字符所编写的模式，其中有些字符不表示字符字面意义，而表示控制或通配的功能
</p>
</div>
<div id="outline-container-orgheadline127" class="outline-3">
<h3 id="orgheadline127">正则表达式的类型</h3>
<div class="outline-text-3" id="text-orgheadline127">
<ul class="org-ul">
<li>基本正则表达式: BRE</li>
<li>扩展正则表达式: ERE (正则表达式引擎: pcre)</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline128" class="outline-3">
<h3 id="orgheadline128">基本正则表达式</h3>
<div class="outline-text-3" id="text-orgheadline128">
<dl class="org-dl">
<dt>字符匹配</dt><dd><ul class="org-ul">
<li><code>.</code>: 匹配任意单个字符</li>
<li><code>[]</code>: 匹配指定范围内的任意单个字符</li>
<li><code>[^]</code>: 匹配指定范围外的任意单个字符
<ul class="org-ul">
<li>专用字符集合: [:digit:]、[:lower:]、[:upper:]、[:alpha:]、[:alnum:]、[:punct:]、[:space:]</li>
</ul></li>
</ul></dd>
<dt>匹配次数</dt><dd><ul class="org-ul">
<li><code>*</code>: 匹配前面的字符任意次(默认是贪婪模式)</li>
<li><code>.*</code>: 任意长度的任意字符</li>
<li><code>\?</code>: 匹配其前面的字符0或1次</li>
<li><code>\+</code>: 匹配其前面的字符至少1次</li>
<li><code>\{m\}</code>: 匹配前面的字符m次</li>
<li><code>\{m,n\}</code>: 匹配前面的字符至少m次，至多n次
<ul class="org-ul">
<li><code>\{0,n\}</code>: 匹配前面的字符至多n次</li>
<li><code>\{m,\}</code>: 匹配前面的字符至少m次</li>
</ul></li>
</ul></dd>
<dt>位置锚定</dt><dd><ul class="org-ul">
<li><code>^</code>: 行首锚定；用于模式的最左侧</li>
<li><code>$</code>: 行尾锚定；用于模式的最右侧</li>
<li><code>^[[:space:]]$</code>: 用于模式匹配整个空白行</li>
<li><code>\&lt;</code> 或 <code>\b</code>: 词首锚定；用于单词模式的左侧</li>
<li><code>\&gt;</code> 或 <code>\b</code>: 词尾锚定；用于单词模式的右侧</li>
<li><code>\&lt;PATTERN\&gt;</code>: 匹配整个单词</li>
</ul></dd>
<dt>分组</dt><dd><ul class="org-ul">
<li><code>\(\)</code>: 将括号内的字符当作一个整体进行处理</li>
<li>分组括号中的模式匹配到的内容会被正则表达式引擎记录于内部变量，可以用于后向引用</li>
<li><code>\1</code>: 从左侧起，第一个左括号以及与之匹配右括号之间的模式所匹配到的字符</li>
</ul></dd>
<dt>或者</dt><dd><ul class="org-ul">
<li><code>\|</code>: 匹配左右两种模式中的一个</li>
<li><code>\(word\|word\)</code>: 两个单词之一</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline129" class="outline-3">
<h3 id="orgheadline129">扩展正则表达式</h3>
<div class="outline-text-3" id="text-orgheadline129">
<ul class="org-ul">
<li>扩展正则表达式与正则表达式的区别，只是在除 <code>\&lt;、\&gt;、\b</code> 外其他特殊字符不需要添加反斜线\</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgheadline180" class="outline-2">
<h2 id="orgheadline180"><span class="section-number-2">9</span> Linux磁盘管理</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-orgheadline131" class="outline-3">
<h3 id="orgheadline131">设备文件</h3>
<div class="outline-text-3" id="text-orgheadline131">
<ul class="org-ul">
<li>设备文件是关联至一个设备驱动程序，进而能够跟与之对应硬件设备进行通信
<ul class="org-ul">
<li>块设备: block，存取单位“块”，磁盘</li>
<li>字符设备: char，存取单位“字符”，键盘</li>
</ul></li>
</ul>


<dl class="org-dl">
<dt>设备号码</dt><dd><ul class="org-ul">
<li>主设备号: major number, 标识设备类型</li>
<li>次设备号: minor number, 标识同一类型下的不同设备</li>
<li>UUID: 设备分区号</li>
</ul></dd>
<dt>硬盘接口类型</dt><dd><ul class="org-ul">
<li>并行: IDE, SCSI</li>
<li>串口: SATA, SAS, USB</li>
</ul></dd>
<dt>磁盘设备的设备文件</dt><dd><ul class="org-ul">
<li>IDE: /dev/hd</li>
<li>SCSI, SATA, SAS, USB: /dev/sd
<ul class="org-ul">
<li>不同设备: sda, sdb, &#x2026;</li>
<li>同一设备不同分区: sda1, sda2, &#x2026;
<ul class="org-ul">
<li>逻辑分区要从5开始编号</li>
</ul></li>
</ul></li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline135" class="outline-3">
<h3 id="orgheadline135">分区管理</h3>
<div class="outline-text-3" id="text-orgheadline135">
</div><div id="outline-container-orgheadline132" class="outline-4">
<h4 id="orgheadline132">fdisk</h4>
<div class="outline-text-4" id="text-orgheadline132">
<ul class="org-ul">
<li>fdisk对一块硬盘最多只能管理15个分区</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">fdisk -l [-u] [device...]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#30475;&#30913;&#30424;&#20998;&#21306;&#20449;&#24687;&#65292;&#40664;&#35748;&#26174;&#31034;&#25152;&#26377;&#20998;&#21306;&#20449;&#24687;</span>
fdisk device  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#31649;&#29702;&#30913;&#30424;&#20998;&#21306; </span>
  p: print, &#26174;&#31034;&#24050;&#26377;&#20998;&#21306;
  n: new, &#21019;&#24314;
  d: delete, &#21024;&#38500;
  w: write, &#20889;&#20837;&#30913;&#30424;&#24182;&#36864;&#20986;
  q: quit, &#25918;&#24323;&#26356;&#26032;&#24182;&#36864;&#20986;
  m: &#33719;&#21462;&#24110;&#21161;
  l: &#26174;&#31034;&#20998;&#21306;id&#21015;&#34920;
  t: &#35843;&#25972;&#20998;&#21306;id
</pre>
</div>
<ul class="org-ul">
<li>查看内核是否已经识别新的分区</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">cat /proc/partations
</pre>
</div>
<ul class="org-ul">
<li>通知内核重新读取分区表</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">partx -a /dev/DEVICE [-n M:N]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#25195;&#25551;DEVICE&#30340;&#20998;&#21306;&#32534;&#21495;&#20174;M&#21040;N&#30340;&#20998;&#21306;</span>
kpartx -a /dev/DEVICE
partprobe [/dev/DEVICE] <span style="color: #75715E;"># </span><span style="color: #75715E;">CentOS 5</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline133" class="outline-4">
<h4 id="orgheadline133"><span class="todo TODO">TODO</span> parted</h4>
</div>
<div id="outline-container-orgheadline134" class="outline-4">
<h4 id="orgheadline134"><span class="todo TODO">TODO</span> sfdisk</h4>
</div>
</div>
<div id="outline-container-orgheadline136" class="outline-3">
<h3 id="orgheadline136">文件系统管理</h3>
<div class="outline-text-3" id="text-orgheadline136">
<p>
Linux的虚拟文件系统VFS为不同的文件系统统一了接口
</p>
</div>
<div id="outline-container-orgheadline137" class="outline-4">
<h4 id="orgheadline137">文件系统</h4>
<div class="outline-text-4" id="text-orgheadline137">
<ul class="org-ul">
<li>Linux文件系统: ext2, ext3, ext4, xfs, btrfs, reiserfs, jfs</li>
<li>交换分区: swap</li>
<li>光盘: iso9660</li>
<li>Windows: fat32, ntfs</li>
<li>Unix: FFS, UFS, JFS2</li>
<li>网络文件系统: NFS, CIFS</li>
<li>集群文件系统: GFS2, OCFS2</li>
<li>分布式文件系统: ceph, moosefs, mogilefs, GlusterFS, Lustre</li>
</ul>


<dl class="org-dl">
<dt>分类</dt><dd><ul class="org-ul">
<li>根据其是否支持"journal"功能(用于提升存储出错后修复的速度)
<ul class="org-ul">
<li>日志型文件系统: ext3, ext4, xfs, &#x2026;</li>
<li>非日志型文件系统: ext2, vfat</li>
</ul></li>
</ul></dd>
</dl>
<div class="org-src-container">

<pre class="src src-conf">cat /proc/filesystem  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21015;&#20986;&#30446;&#21069;&#31995;&#32479;&#25152;&#25903;&#25345;&#30340;&#25991;&#20214;&#31995;&#32479;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline141" class="outline-4">
<h4 id="orgheadline141">创建文件系统</h4>
<div class="outline-text-4" id="text-orgheadline141">
</div><ul class="org-ul"><li><a id="orgheadline138"></a>mkfs<br  /><div class="outline-text-5" id="text-orgheadline138">
<p>
通用格式化分区工具
</p>
<div class="org-src-container">

<pre class="src src-conf">mkfs.FS_TYPE /dev/DEVICE
mkfs -t FS_TYPE /dev/DEVICE
  FS_TYPE: ext4, xfs, btrfs, vfat
  -L <span style="color: #E6DB74;">'LABEL'</span>: &#35774;&#23450;&#21367;&#26631;
  -f: &#24378;&#21046;&#21019;&#24314;&#25991;&#20214;&#31995;&#32479;
</pre>
</div>
</div></li>
<li><a id="orgheadline139"></a>mke2fs<br  /><div class="outline-text-5" id="text-orgheadline139">
<p>
ext系列文件系统专用管理工具
</p>
<div class="org-src-container">

<pre class="src src-conf">mke2fs [OPTIONS...] /dev/DEVICE
  -t {ext2|ext3|ext4}
  -L <span style="color: #E6DB74;">'LABEL'</span>
  -j: &#28155;&#21152;&#26085;&#24535;&#65292;&#30456;&#24403;&#20110; -t ext3
  -b {1024|2048|4096}: &#22359;&#22823;&#23567;(&#22914;&#26524;&#23567;&#25991;&#20214;&#36807;&#22810;&#21487;&#20197;&#20351;&#29992;&#36739;&#23567;&#30340;&#22359;)
  -i NUM: &#20026;&#25968;&#25454;&#31354;&#38388;&#20013;&#27599;&#22810;&#23569;&#23383;&#33410;&#21019;&#24314;&#19968;&#20010;inode&#65307;&#27492;&#22823;&#23567;&#19981;&#24212;&#35813;&#23567;&#20110;block&#30340;&#22823;&#23567;&#65307;
  -N NUM: &#20026;&#25968;&#25454;&#31354;&#38388;&#21019;&#24314;&#22810;&#23569;&#20010;inode&#65307;
  -m NUM: &#20026;&#31649;&#29702;&#20154;&#21592;&#39044;&#30041;&#30340;&#31354;&#38388;&#21344;&#25454;&#30340;&#30334;&#20998;&#27604;&#65307;
  -O [^]FEATURE[,...]: &#21551;&#29992;&#25110;&#20851;&#38381;&#25351;&#23450;&#29305;&#24615;
</pre>
</div>
</div></li>
<li><a id="orgheadline140"></a>mkswap<br  /><div class="outline-text-5" id="text-orgheadline140">
<p>
创建交换分区(分区id为82)
</p>
<div class="org-src-container">

<pre class="src src-conf">mkswap [OPTIONS] device
  -L <span style="color: #E6DB74;">'LABEL'</span>
</pre>
</div>
</div></li></ul>
</div>

<div id="outline-container-orgheadline146" class="outline-4">
<h4 id="orgheadline146">其他常用工具</h4>
<div class="outline-text-4" id="text-orgheadline146">
</div><ul class="org-ul"><li><a id="orgheadline142"></a>blkid<br  /><div class="outline-text-5" id="text-orgheadline142">
<p>
块设备属性信息查看
</p>
<div class="org-src-container">

<pre class="src src-conf">blkid [OPTION...] [DEVICE]
  -U UUID: &#26681;&#25454;&#25351;&#23450;&#30340;UUID&#26469;&#26597;&#25214;&#23545;&#24212;&#30340;&#35774;&#22791;
  -L LABEL: &#26681;&#25454;&#25351;&#23450;&#30340;LABEL&#26469;&#26597;&#25214;&#23545;&#24212;&#30340;&#35774;&#22791;
</pre>
</div>
</div></li>
<li><a id="orgheadline143"></a>e2label<br  /><div class="outline-text-5" id="text-orgheadline143">
<p>
查看或设定ext系列文件系统的LABEL
</p>
<div class="org-src-container">

<pre class="src src-conf">e2label DEVICE [LABEL]
</pre>
</div>
</div></li>
<li><a id="orgheadline144"></a>tune2fs<br  /><div class="outline-text-5" id="text-orgheadline144">
<p>
重新设定ext系列文件系统的可调整参数的值
</p>
<div class="org-src-container">

<pre class="src src-conf">tune2fs [OPTIONS...] /dev/DEVICE
  -l: &#26597;&#30475;&#25351;&#23450;&#25991;&#20214;&#31995;&#32479;&#36229;&#32423;&#22359;&#20449;&#24687;(super block)
  -L <span style="color: #E6DB74;">'LABEL'</span>: &#20462;&#25913;&#21367;&#26631;
  -U UUID: &#20462;&#25913;UUID&#21495;
  -m NUM: &#20462;&#39044;&#30041;&#32473;&#31649;&#29702;&#21592;&#30340;&#31354;&#38388;&#30334;&#20998;&#27604;
  -j: &#23558;ext2&#21319;&#32423;&#20026;ext3
  -O [^]FEATURE: &#25991;&#20214;&#31995;&#32479;&#23646;&#24615;&#21551;&#29992;&#25110;&#31105;&#29992;
  -o [^]FLAG: &#35843;&#25972;&#25991;&#20214;&#31995;&#32479;&#30340;&#40664;&#35748;&#25346;&#36733;&#36873;&#39033;
</pre>
</div>
</div></li>
<li><a id="orgheadline145"></a>dumpe2fs<br  /><div class="outline-text-5" id="text-orgheadline145">
<p>
查询ext分区的布局信息和超级块信息
</p>
</div></li></ul>
</div>
<div id="outline-container-orgheadline149" class="outline-4">
<h4 id="orgheadline149">文件系统检测</h4>
<div class="outline-text-4" id="text-orgheadline149">
</div><ul class="org-ul"><li><a id="orgheadline147"></a>fsck<br  /><div class="outline-text-5" id="text-orgheadline147">
<p>
File System Check
</p>
<div class="org-src-container">

<pre class="src src-conf">fsck.FS_TYPE [OPTIONS...] DEVICE
fsck -t FS_TYPE [OPTIONS...] DEVICE
  -a: &#33258;&#21160;&#20462;&#22797;&#38169;&#35823;
  -r: &#20132;&#20114;&#24335;&#20462;&#22797;&#38169;&#35823;
</pre>
</div>
</div></li>
<li><a id="orgheadline148"></a>e2fsck<br  /><div class="outline-text-5" id="text-orgheadline148">
<p>
ext文件系统专用的检测修复工具
</p>
<div class="org-src-container">

<pre class="src src-conf">e2fsck [OPTIONS...] DEVICE
  -y: &#33258;&#21160;&#20462;&#22797;&#38169;&#35823;
  -f: &#24378;&#21046;&#20462;&#22797;
</pre>
</div>
</div></li></ul>
</div>
</div>
<div id="outline-container-orgheadline155" class="outline-3">
<h3 id="orgheadline155">文件系统管理</h3>
<div class="outline-text-3" id="text-orgheadline155">
</div><div id="outline-container-orgheadline150" class="outline-4">
<h4 id="orgheadline150">挂载</h4>
<div class="outline-text-4" id="text-orgheadline150">
<ul class="org-ul">
<li>挂载: 额外文件系统与根文件系统某现存的目录(挂载点)建立起关联关系，进而使得此目录做为其它文件访问入口的行为</li>
<li>挂载点下的原有文件在挂载完成后会被临时隐藏</li>
<li>查看内核追踪到的已挂载的所有设备: cat /proc/mounts</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">mount  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#36890;&#36807;&#26597;&#30475;/etc/mtab&#25991;&#20214;&#26597;&#30475;&#31995;&#32479;&#24050;&#25346;&#36733;&#30340;&#25152;&#26377;&#35774;&#22791;</span>
mount [-fnrsvw] [-t vfstype] [-o options] DEVICE MOUNT_POINT
  DEVICE: &#35774;&#22791;&#25991;&#20214;/&#21367;&#26631;/UUID/&#20266;&#25991;&#20214;&#31995;&#32479;&#21517;&#23383;(proc, sysfs, devtmpfs, configfs)
  -t vsftype: &#25351;&#23450;&#35201;&#25346;&#36733;&#30340;&#35774;&#22791;&#19978;&#30340;&#25991;&#20214;&#31995;&#32479;&#31867;&#22411;&#65292;&#40664;&#35748;&#20250;&#20351;&#29992;blkid&#33258;&#21160;&#21028;&#26029;
  -r: readonly&#65292;&#21482;&#35835;&#25346;&#36733;
  -w: read and write, &#35835;&#20889;&#25346;&#36733;
  -n: &#19981;&#26356;&#26032;/etc/mtab&#65292;&#20294;&#36824;&#26159;&#20250;&#26356;&#26032;&#21040;/proc/mounts
  -a: &#33258;&#21160;&#25346;&#36733;/etc/fstab&#20013;&#25903;&#25345;&#33258;&#21160;&#25346;&#36733;&#30340;&#35774;&#22791;
  -L <span style="color: #E6DB74;">'LABEL'</span>: &#20197;&#21367;&#26631;&#25351;&#23450;&#25346;&#36733;&#35774;&#22791;
  -U <span style="color: #E6DB74;">'UUID'</span>: &#20197;UUID&#25351;&#23450;&#35201;&#25346;&#36733;&#30340;&#35774;&#22791;
  -B, --bind: &#32465;&#23450;&#30446;&#24405;&#21040;&#21478;&#19968;&#20010;&#30446;&#24405;&#19978;

  -o options: &#25346;&#36733;&#25991;&#20214;&#31995;&#32479;&#36873;&#39033;
    remount: &#37325;&#26032;&#25346;&#36733;
    async: &#24322;&#27493;&#27169;&#24335;
    sync: &#21516;&#27493;&#27169;&#24335;(&#20462;&#25913;&#31435;&#21363;&#20889;&#20154;&#30913;&#30424;)
    atime/noatime: &#24320;&#20851;&#30446;&#24405;&#21644;&#25991;&#20214;&#30340;atime&#30340;&#26356;&#26032;
    diratime/nodiratime: &#24320;&#20851;&#30446;&#24405;&#30340;atime&#30340;&#26356;&#26032;
    auto/noauto: &#26159;&#21542;&#33258;&#21160;&#25346;&#36733;
    exec/noexec: &#26159;&#21542;&#25903;&#25345;&#23558;&#25991;&#20214;&#31995;&#32479;&#19978;&#24212;&#29992;&#31243;&#24207;&#36816;&#34892;&#20026;&#36827;&#31243;
    dev/nodev: &#26159;&#21542;&#25903;&#25345;&#22312;&#27492;&#25991;&#20214;&#31995;&#32479;&#19978;&#20351;&#29992;&#35774;&#22791;&#25991;&#20214;
    suid/nosuid: &#24320;&#20851;suid&#30340;&#25903;&#25345;
    ro/rw: &#21482;&#35835;/&#35835;&#20889;
    user/nouser: &#26159;&#21542;&#20801;&#35768;&#26222;&#36890;&#29992;&#25143;&#25346;&#36733;&#27492;&#35774;&#22791;(&#40664;&#35748;&#21482;&#33021;&#30001;root&#25346;&#36733;)
    acl: &#21551;&#29992;&#27492;&#25991;&#20214;&#31995;&#32479;&#19978;&#30340;acl&#21151;&#33021;
      defaults: &#30456;&#24403;&#20110;rw, suid, dev, exec, auto, nouser, async
</pre>
</div>


<dl class="org-dl">
<dt>挂载光盘设备</dt><dd><ul class="org-ul">
<li>光盘的设备文件: <code>/dev/hdc或/dev/sr0</code>, 我们一般使用符号链接文件 <code>/dev/cdrom</code></li>
<li>光盘挂载一般使用 <code>-r</code> 只读选项</li>
<li>光盘文件则需要加上 <code>-t iso9660</code> 选项</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline151" class="outline-4">
<h4 id="orgheadline151">卸载</h4>
<div class="outline-text-4" id="text-orgheadline151">
<ul class="org-ul">
<li>卸载: 解除挂载关联关系的过程</li>
<li>进程正在使用中的设备无法被卸载</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">umount DEVICE/MOUNT_POINT
</pre>
</div>
<ul class="org-ul">
<li>检查访问文件系统的进程</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">fuser -v MOUNT_POINT  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#30475;&#27491;&#35775;&#38382;&#25351;&#23450;&#25991;&#20214;&#31995;&#32479;&#30340;&#36827;&#31243;</span>
fuser -km MOUNT_POINT  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#32456;&#27490;&#25152;&#26377;&#27491;&#35775;&#38382;&#25351;&#23450;&#25991;&#20214;&#31995;&#32479;&#30340;&#36827;&#31243;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline152" class="outline-4">
<h4 id="orgheadline152">交换分区</h4>
<div class="outline-text-4" id="text-orgheadline152">
<dl class="org-dl">
<dt>启用</dt><dd><div class="org-src-container">

<pre class="src src-conf">swapon [OPTION] [DEVICE]
  -a: &#28608;&#27963;&#25152;&#26377;&#20132;&#25442;&#20998;&#21306;&#65292;&#19981;&#29992;&#25351;&#23450;DEVICE
  -p PRIORITY: &#25351;&#23450;&#20132;&#25442;&#20998;&#21306;&#30340;&#20248;&#20808;&#32423;
</pre>
</div></dd>
<dt>禁用</dt><dd><div class="org-src-container">

<pre class="src src-conf">swapoff [OPTION] [DEVICE]
</pre>
</div></dd>
<dt>内存空间使用状态</dt><dd><div class="org-src-container">

<pre class="src src-conf">free [OPTION]
  -m: &#20197;MB&#20026;&#21333;&#20301;
</pre>
</div>
<ul class="org-ul">
<li>真正的内存使用=used-buffers-cached</li>
</ul></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline153" class="outline-4">
<h4 id="orgheadline153">空间占用查询</h4>
<div class="outline-text-4" id="text-orgheadline153">
<dl class="org-dl">
<dt>文件系统空间占用信息</dt><dd><div class="org-src-container">

<pre class="src src-conf">df [OPTIONS]
  -l: &#21482;&#26174;&#31034;&#26412;&#22320;&#25991;&#20214;&#31995;&#32479;&#20998;&#21306;
  -h: human-readable
  -i: &#26174;&#31034;inodes&#30340;&#20351;&#29992;&#24773;&#20917;
  -P: &#20197;Posix&#20860;&#23481;&#30340;&#26684;&#24335;&#36755;&#20986;&#65292;&#26041;&#20415;&#20110;&#25991;&#23383;&#22788;&#29702;&#24037;&#20855;
</pre>
</div>
<ul class="org-ul">
<li>df是通过元数据来统计，会计算一些正使用但已经被删除的文件</li>
</ul></dd>
<dt>查看某目录空间占用信息</dt><dd><div class="org-src-container">

<pre class="src src-conf">du [OPTIONS] DIR
  -h: human-readabel
  -s: &#21482;&#26174;&#31034;&#25351;&#23450;&#30446;&#24405;
</pre>
</div>
<ul class="org-ul">
<li>du不会记录一些正使用但已经被删除的文件</li>
</ul></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline154" class="outline-4">
<h4 id="orgheadline154">/etc/fstab</h4>
<div class="outline-text-4" id="text-orgheadline154">
<ul class="org-ul">
<li>/etc/fstab 是文件挂载的配置文件</li>
<li>每行定义一个要挂载的文件系统</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">&#35201;&#25346;&#36733;&#30340;&#35774;&#22791;&#25110;&#20266;&#25991;&#20214;&#31995;&#32479;  &#25346;&#36733;&#28857;  &#25991;&#20214;&#31995;&#32479;&#31867;&#22411;  &#25346;&#36733;&#36873;&#39033;  &#22791;&#20221;&#39057;&#29575;  &#33258;&#26816;&#27425;&#24207;
  &#35201;&#25346;&#36733;&#30340;&#35774;&#22791;&#25110;&#20266;&#25991;&#20214;&#31995;&#32479;: 
    <span style="color: #FD971F;">&#35774;&#22791;&#25991;&#20214;&#12289;LABEL(LABEL</span>=<span style="color: #E6DB74;">""</span>)&#12289;UUID(UUID=<span style="color: #E6DB74;">""</span>)&#12289;&#20266;&#25991;&#20214;&#31995;&#32479;&#21517;&#31216;(proc, sysfs)
  &#25346;&#36733;&#36873;&#39033;: 
    defaults ...
  &#22791;&#20221;&#39057;&#29575;: 
    0: &#19981;&#20570;&#22791;&#20221;
    1: &#27599;&#22825;&#22791;&#20221;
    2: &#27599;&#38548;&#19968;&#22825;&#22791;&#20221;
  &#33258;&#26816;&#27425;&#24207;: 
    0: &#19981;&#33258;&#26816;
    NUM: &#33258;&#26816;&#30340;&#20248;&#20808;&#32423;&#65292;&#19968;&#33324;&#21482;&#26377;rootfs&#25165;&#29992;1
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline156" class="outline-3">
<h3 id="orgheadline156">Ext2的块组</h3>
<div class="outline-text-3" id="text-orgheadline156">
<p>
Ext2区分为多个block group, 每个块组都有独立的inode/block/superblock系统
</p>
</div>
<div id="outline-container-orgheadline157" class="outline-4">
<h4 id="orgheadline157">data block</h4>
<div class="outline-text-4" id="text-orgheadline157">
<p>
用于放置文件内容地方
</p>
<ul class="org-ul">
<li>Ext2文件系统支持block大小有1KB,2KB,4KB</li>
<li>每个block最多只能放置一个文件的数据</li>
<li>block太大会造成空间浪费, 太小造成性能下降</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline158" class="outline-4">
<h4 id="orgheadline158">inodetable</h4>
<div class="outline-text-4" id="text-orgheadline158">
<ul class="org-ul">
<li>inode记录的文件数据: 该文件的访问模式,所有者与组,大小,ctime/atime/mtime,flag,内容指向</li>
<li>inode大小:Ext3是128bytes, Ext4是256bytes</li>
<li>能够创建的文件数量与inode的数量有关</li>
<li>读取文件会先验证inode记录的权限与用户</li>
<li>inode记录一个block需要4byte</li>
<li>Ext3由12直接\1间接\1双间接\1三间接组成
<ul class="org-ul">
<li>间接是使用一个block来记录block号码</li>
<li>Ext4使用extent存储连续的数据块</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline159" class="outline-4">
<h4 id="orgheadline159">Superblock</h4>
<div class="outline-text-4" id="text-orgheadline159">
<p>
superblock一般为1024bytes(dumpe2fs可查询)
</p>
<ul class="org-ul">
<li>记录的信息: block/inode的总量,未使用的inode/block数量,block与inode的大小,文件系统挂载时间,最近写数据时间,最近fsck时间等相关信息</li>
<li>validbit:被挂载时这个位为0,未挂载时为1</li>
<li>superblock一般只位于第一个block group中, 后续若存在则为第一个的备份</li>
<li>当block为1KB, superblock位于block1, boot sector位于block0(第一个扇区)</li>
<li>当block为2/4KB, superblock和boot sector都位于block0</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline160" class="outline-4">
<h4 id="orgheadline160">File system Description</h4>
<div class="outline-text-4" id="text-orgheadline160">
<p>
记录每个block group的开始和结束的block号码, 以及说明每个区段的block号码(dumpe2fs可查询)
</p>
</div>
</div>
<div id="outline-container-orgheadline161" class="outline-4">
<h4 id="orgheadline161">block bitmap</h4>
<div class="outline-text-4" id="text-orgheadline161">
<p>
记录使用与未使用的block号码
</p>
</div>
</div>
<div id="outline-container-orgheadline162" class="outline-4">
<h4 id="orgheadline162">inode bitmap</h4>
<div class="outline-text-4" id="text-orgheadline162">
<p>
记录使用与未使用的inode号码
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline166" class="outline-3">
<h3 id="orgheadline166">文件系统的其他概念</h3>
<div class="outline-text-3" id="text-orgheadline166">
</div><div id="outline-container-orgheadline163" class="outline-4">
<h4 id="orgheadline163">目录</h4>
<div class="outline-text-4" id="text-orgheadline163">
<p>
目录占用一个inode和至少一个block
</p>
<ul class="org-ul">
<li>inode记录目录的相关权限属性和block号码</li>
<li>block记录目录下文件名和对应的inode号码数据</li>
<li>目录树读取, 一层一层目录检验用户的权限</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline164" class="outline-4">
<h4 id="orgheadline164">文件的写入过程</h4>
<div class="outline-text-4" id="text-orgheadline164">
<ol class="org-ol">
<li>确定是否有权限</li>
<li>由inode bitmap找到一个没有使用的inode, 写入新文件的权限/属性</li>
<li>由block bitmap找到没有使用的block, 写入数据后更新inode的指向</li>
<li>同步更新至inode/block bitmap, superblock</li>
</ol>
</div>
</div>
<div id="outline-container-orgheadline165" class="outline-4">
<h4 id="orgheadline165">链接文件</h4>
<div class="outline-text-4" id="text-orgheadline165">
<dl class="org-dl">
<dt>硬链接</dt><dd><ul class="org-ul">
<li>不能够对目录进行(但 <code>.</code> 和 <code>..</code> 也算是目录的硬链接)</li>
<li>不能跨分区进行</li>
<li>指向同一个inode的多个不同路径；创建文件的硬链接即为为inode创建新的引用路径，因此会增加其引用计数</li>
</ul></dd>

<dt>符号</dt><dd><ul class="org-ul">
<li>可以对目录进行</li>
<li>可以跨分区</li>
<li>指向的是另一个文件的路径；其大小为指向的路径字符串的长度；不增加或减少目标文件inode的引用计数</li>
</ul></dd>

<dt>创建链接文件</dt><dd></dd>
</dl>
<div class="org-src-container">

<pre class="src src-conf">ln [-sv] SRC DEST  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#40664;&#35748;&#21019;&#24314;&#30828;&#38142;&#25509;</span>
  -s: &#21019;&#24314;&#31526;&#21495;&#36830;&#25509;
  -v: verbose
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline167" class="outline-3">
<h3 id="orgheadline167">RAID</h3>
<div class="outline-text-3" id="text-orgheadline167">
<p>
RAID: Redundant Arrays of Independent Disks
</p>
<ul class="org-ul">
<li>提高IO能力
<ul class="org-ul">
<li>磁盘并行读写</li>
<li>额外提供CPU、内存、电源</li>
</ul></li>
<li>提高耐用性
<ul class="org-ul">
<li>磁盘冗余实现</li>
</ul></li>
</ul>
</div>
<div id="outline-container-orgheadline168" class="outline-4">
<h4 id="orgheadline168">RAID的实现方式</h4>
<div class="outline-text-4" id="text-orgheadline168">
<ul class="org-ul">
<li>外接式磁盘阵列: 通过扩展卡提供适配能力</li>
<li>内接式RAID: 主板集成RAID控制器</li>
<li>Software RAID:</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline169" class="outline-4">
<h4 id="orgheadline169">RAID级别</h4>
<div class="outline-text-4" id="text-orgheadline169">
<dl class="org-dl">
<dt>RAID-0</dt><dd><ul class="org-ul">
<li>将数据分成若干chunk，分散到每个硬盘中</li>
<li>读、写性能提升</li>
<li>可用空间: N*min(S1,S2,&#x2026;)</li>
<li>无容错能力</li>
</ul></dd>
<dt>RAID-1</dt><dd><ul class="org-ul">
<li>将数据分成若干chunk，复制到每个硬盘中</li>
<li>读性能提升、写性能略下降</li>
<li>1*min(S1,S2,&#x2026;)</li>
<li>有冗余能力</li>
</ul></dd>
<dt>RAID-4</dt><dd><ul class="org-ul">
<li>3个硬盘中1个硬盘存储校验码</li>
<li>有容错能力: 1块磁盘</li>
</ul></dd>
<dt>RAID-5</dt><dd><ul class="org-ul">
<li>在RAID-4的基础上，轮流用硬盘存储校验码</li>
<li>读、写性能提升</li>
<li>可用空间: (N-1)*min(S1,S2,&#x2026;)</li>
<li>有容错能力: 1块磁盘</li>
<li>最少使用3块磁盘</li>
</ul></dd>
<dt>RAID-6</dt><dd><ul class="org-ul">
<li>轮流用两块硬盘做校验盘</li>
<li>读、写性能提升</li>
<li>可用空间: (N-2)*min(S1,S2,&#x2026;)</li>
<li>有容错能力: 2块磁盘</li>
<li>最少使用4块磁盘</li>
</ul></dd>
<dt>RAID-10</dt><dd><ul class="org-ul">
<li>先两两一组进行RAID-1，后用RAID-0</li>
<li>读、写性能提升</li>
<li>可用空间: N*min(S1,S2,&#x2026;)/2</li>
<li>有容错能力: 每组镜像最多只能坏一块</li>
<li>最少磁盘数: 4, 4+</li>
</ul></dd>
<dt>JBOD</dt><dd><ul class="org-ul">
<li>Just a Bunch Of Disks</li>
<li>将多块磁盘的空间合并一个大的连续空间使用，即顺序使用</li>
</ul></dd>
</dl>
</div>
</div>
<div id="outline-container-orgheadline170" class="outline-4">
<h4 id="orgheadline170">软件实现RAID</h4>
<div class="outline-text-4" id="text-orgheadline170">
<ul class="org-ul">
<li>可以查询 <code>/proc/mdstat</code> 来查询电脑的RAID情况</li>
<li>mdadm: 模式化工具，使用内核中的md模块(multi devices)</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">mdadm [mode] &lt;raiddevice&gt; [options] &lt;component-devices&gt;
  mode:
    &#21019;&#24314;: -C
    &#35013;&#37197;: -A
    &#30417;&#25511;: -F
    &#31649;&#29702;: -f, -r, -a
  &lt;raiddevice&gt;: /dev/md[num]  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#37325;&#21551;&#21487;&#33021;&#20250;&#25913;&#21464;</span>
  &lt;component-devices&gt;: &#20219;&#24847;&#22359;&#35774;&#22791;(id&#20026;fd)

  -C: &#21019;&#24314;&#27169;&#24335;
    -n num: &#20351;&#29992;num&#20010;&#22359;&#35774;&#22791;&#26469;&#21019;&#24314;&#27492;RAID
    -l num: &#25351;&#26126;&#35201;&#21019;&#24314;&#30340;RAID&#30340;&#32423;&#21035;
    -a {yes|no}: &#33258;&#21160;&#21019;&#24314;&#30446;&#26631;RAID&#35774;&#22791;&#30340;&#35774;&#22791;&#25991;&#20214;
    -c CHUNK_SIZE: &#25351;&#26126;&#22359;&#22823;&#23567;
    -x num: &#25351;&#26126;&#31354;&#38386;&#30424;&#30340;&#20010;&#25968;

  -S: &#20572;&#27490;md&#35774;&#22791;
  -D: &#26174;&#31034;RAID&#30340;&#35814;&#32454;&#20449;&#24687;

  &#31649;&#29702;&#27169;&#24335;
    -f: &#26631;&#35760;&#25351;&#23450;&#30913;&#30424;&#20026;&#25439;&#22351;
    -a: &#28155;&#21152;&#30913;&#30424;
    -r: &#31227;&#38500;&#30913;&#30424;
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline171" class="outline-3">
<h3 id="orgheadline171">LVM2</h3>
<div class="outline-text-3" id="text-orgheadline171">
<p>
LVM: Logical Volume Manager, 使用内核中的dm模块(device mapper)
</p>
<ul class="org-ul">
<li>LVM的空间调整是通过调整PE(Physical Extent)的分配来进行调整的</li>
</ul>

<div class="figure">
<p><img src="linuxOperation_1.png" alt="linuxOperation_1.png" />
</p>
</div>
</div>

<div id="outline-container-orgheadline172" class="outline-4">
<h4 id="orgheadline172">设备文件</h4>
<div class="outline-text-4" id="text-orgheadline172">
<dl class="org-dl">
<dt>实际文件</dt><dd>/dev/dm-[NUM]</dd>
<dt>链接文件</dt><dd><ul class="org-ul">
<li>/dev/mapper/VG_NAME-LV_NAME</li>
<li>/dev/VG_NAME/LV_NAME</li>
</ul></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline173" class="outline-4">
<h4 id="orgheadline173">pv管理工具</h4>
<div class="outline-text-4" id="text-orgheadline173">
<p>
pv: Physical Volume
</p>
<ul class="org-ul">
<li>使用的磁盘设备文件id应为8e</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">pvs  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#31616;&#35201;&#26174;&#31034;&#31995;&#32479;&#19978;&#30446;&#21069;&#30340;pv&#20449;&#24687;</span>
pvdisplay  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26174;&#31034;pv&#30340;&#35814;&#32454;&#20449;&#24687;</span>

pvcreate /dev/DEVICE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21019;&#24314;pv</span>
pvremove /dev/DEVICE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21024;&#38500;pv</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline174" class="outline-4">
<h4 id="orgheadline174">vg管理命令</h4>
<div class="outline-text-4" id="text-orgheadline174">
<p>
vg: Volume Group
</p>
<div class="org-src-container">

<pre class="src src-conf">vgs
vgdisplay

vgcreate [-s PE_Size(&#40664;&#35748;4MB)] VolumeGroupName PhysicalDevicePath...  
vgextend VolumeGroupName PhysicalDevicePath...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22686;&#21152;vg&#30340;pv&#25968;</span>
vgreduce VolumeGroupName PhysicalDevicePath...  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21024;&#38500;vg&#20013;&#30340;pv</span>
<span style="color: #75715E;"># </span><span style="color: #75715E;">vgreduce&#20043;&#21069;&#35201;&#23545;pv&#20808;&#20570;pvmove&#65292;&#31227;&#21160;&#19978;&#36793;&#30340;&#25968;&#25454;</span>
vgremove VolumeGroupName  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21024;&#38500;vg</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline175" class="outline-4">
<h4 id="orgheadline175">lv管理工具</h4>
<div class="outline-text-4" id="text-orgheadline175">
<p>
lv: Logical Volume
</p>
<div class="org-src-container">

<pre class="src src-conf">lvs
lvdisplay

lvcreate -L LV_Size -n NAME VolumeGroupName
lvremove /dev/VG_NAME/LV_NAME
</pre>
</div>

<dl class="org-dl">
<dt>逻辑卷的扩展</dt><dd><div class="org-src-container">

<pre class="src src-conf">lvextend -L [+]SIZE /dev/VG_NAME/LV_NAME  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;&#36923;&#36753;&#21367;&#30340;&#29289;&#29702;&#36793;&#30028;</span>
resize2fs /dev/VG_NAME/LV_NAME  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;&#36923;&#36753;&#21367;&#30340;&#36923;&#36753;&#36793;&#30028;</span>
</pre>
</div></dd>
<dt>逻辑卷的缩减</dt><dd><div class="org-src-container">

<pre class="src src-conf">umount /dev/VG_NAME/LV_NAME
e2fsck -f /dev/VG_NAME/LV_NAME  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#24378;&#21046;&#26816;&#27979;&#20462;&#22797;</span>
resize2fs /dev/VG_NAME/LV_NAME SIZE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;&#36923;&#36753;&#36793;&#30028;</span>
lvreduce -L [-]SIZE /dev/VG_NAME/LV_NAME  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#20462;&#25913;&#29289;&#29702;&#36793;&#30028;</span>
mount /dev/VG_NAME/LV_NAME
</pre>
</div></dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline176" class="outline-4">
<h4 id="orgheadline176">快照</h4>
<div class="outline-text-4" id="text-orgheadline176">
<p>
快照卷仅存储创建快照卷以后逻辑卷所变化的文件，快照是特殊的逻辑卷
</p>
<ul class="org-ul">
<li>快照卷经常用于对逻辑卷的备份的过程中</li>
</ul>
<div class="org-src-container">

<pre class="src src-conf">lvcreate -L SIZE -p r -s -n snapshot_lv_name original_lv_name
  -p r: &#24555;&#29031;&#21367;&#26159;&#21482;&#35835;&#26435;&#38480;
  -s: &#34920;&#31034;&#21019;&#24314;&#24555;&#29031;
lvremove snapshot_lv_name
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline177" class="outline-3">
<h3 id="orgheadline177">btrfs文件系统</h3>
<div class="outline-text-3" id="text-orgheadline177">
<p>
Btrfs: B-tree FS
</p>
</div>
<div id="outline-container-orgheadline178" class="outline-4">
<h4 id="orgheadline178">核心特性</h4>
<div class="outline-text-4" id="text-orgheadline178">
<ul class="org-ul">
<li>多物理卷支持: btrfs可由多个底层物理卷组成；支持RAID, 以联机添加、移除、修改</li>
<li>写时复制更机制(CoW): 每次写磁盘数据时，先将更新数据写入一个新的 block，当新数据写入成功之后，再更新相关的数据结构指向新block</li>
<li>数据及元数据校验码: checksum</li>
<li>子卷: sub_volume</li>
<li>快照: 支持快照的快照</li>
<li>透明压缩</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline179" class="outline-4">
<h4 id="orgheadline179">文件系统相关命令</h4>
<div class="outline-text-4" id="text-orgheadline179">
<div class="org-src-container">

<pre class="src src-bash">mkfs.btrfs <span style="color: #AE81FF;">[</span>OPTIONS<span style="color: #AE81FF;">]</span> <span style="color: #AE81FF;">[</span>DEVICE...<span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21019;&#24314;&#25991;&#20214;&#31995;&#32479;</span>
  -L <span style="color: #E6DB74;">'LABEL'</span>
  -d &lt;type&gt;: &#25968;&#25454;&#23384;&#25918;&#26426;&#21046;, &#21487;&#20026;raid0, raid1, raid5, raid6, raid10, single
  -m &lt;profile&gt;: &#20803;&#25968;&#25454;&#23384;&#25918;&#26426;&#21046;, &#21487;&#20026;raid0, raid1, raid5, raid6, raid10, single, dup
  -O &lt;feature&gt;
    -O list-all: &#21015;&#20986;&#25903;&#25345;&#30340;&#25152;&#26377;feature&#65307;

btrfs filesystem show <span style="color: #AE81FF;">[</span>DEVICE<span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23646;&#24615;&#26597;&#30475;</span>
btrfs filesystem df <span style="color: #AE81FF;">[</span>DEVICE<span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#30475;&#31354;&#38388;&#21344;&#29992;&#24773;&#20917;</span>
btrfs filesystem resize <span style="color: #AE81FF;">[</span>+/-<span style="color: #AE81FF;">]</span>SIZE/max DEVICE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#35843;&#25972;&#25991;&#20214;&#31995;&#32479;&#30340;&#22823;&#23567;</span>

btrfs device add/delete DEVICE PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#28155;&#21152;&#21644;&#21024;&#38500;&#35774;&#22791;</span>
btrfs balance start PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#24179;&#22343;&#20998;&#37197;&#35774;&#22791;&#19978;&#30340;&#25968;&#25454;</span>

btrfs subvolume list <span style="color: #AE81FF;">[</span>PATH<span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#26597;&#35810;&#23376;&#21367;</span>
btrfs subvolume create/delete PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#22312;&#25346;&#36733;&#30340;&#30446;&#24405;&#19979;&#21019;&#24314;&#25110;&#21024;&#38500;&#23376;&#21367;&#25110;&#24555;&#29031;, &#21363;&#23376;&#21367;&#26159;DEVICE&#25346;&#36733;&#30446;&#24405;&#19979;&#30340;&#19968;&#20010;&#30446;&#24405;</span>
btrfs subvolume snapshot sub_volume PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23545;&#23376;&#21367;&#21019;&#24314;&#24555;&#29031;PATH</span>
mount -o <span style="color: #FD971F;">subvol</span>=logs DEVICE  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#21482;&#25346;&#36733;DEVICE&#19979;&#21517;&#23383;&#20026;logs&#30340;&#23376;&#21367;</span>
mount -o <span style="color: #FD971F;">subvolid</span>=NUM DEVICE  

btrfs-convert <span style="color: #AE81FF;">[</span>DEVICE<span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#36716;&#25442;ext&#31995;&#32479;&#30340;&#35774;&#22791;&#20026;btrfs</span>
btrfs-convert -r <span style="color: #AE81FF;">[</span>DEVICE<span style="color: #AE81FF;">]</span>  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#24674;&#22797;btrfs&#30340;&#36716;&#25442;</span>

cp --reflink FILE1 PATH  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#23545;&#25991;&#20214;&#21019;&#24314;&#24555;&#29031;</span>

mount -o <span style="color: #FD971F;">compress</span>=<span style="color: #AE81FF;">{</span>lzo|zlib<span style="color: #AE81FF;">}</span> DEVICE MOUNT_POINT  <span style="color: #75715E;"># </span><span style="color: #75715E;">&#36879;&#26126;&#21387;&#32553;&#26426;&#21046;</span>
</pre>
</div>
</div>
</div>
</div>
</div>
