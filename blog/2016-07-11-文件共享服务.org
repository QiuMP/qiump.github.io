#+TITLE: 文件共享服务
#+DATE: 2016-07-11
#+SETUPFILE: ~/myblog/setupfile.org
#+JEKYLL_LAYOUT: post
#+JEKYLL_CATEGORIES: 网络
#+JEKYLL_TAGS: Linux 运维 网络
#+JEKYLL_PUBLISHED: true

* 文件共享服务
- 文件共享服务用于实现NAS
- 应用层: ftp
- 内核: nfs
- 跨平台: samba
  - 该软件在Linux实现Win下的CIFS(SMB)协议

* ftp
** ftp相关知识
- ftp(File Transfer Protocol)是一个C/S架构的应用层协议(21/tcp)，使用明文传输
*** 连接类型
- 命令连接(21/tcp): 用于传输文件管理类命令，始终在线的连接
- 数据连接: 用于传输数据，按需创建和关闭的连接
  - 数据传输格式: 文本传输，二进制传输
  - 主动连接: 由服务器创建连接
  - 被动连接: 服务器生成一个随机端口，由客户端创建连接
    - 服务器的防火墙要进行特殊配置来允许随机端口
*** 程序软件
- Server: wu-ftpd、proftpd、pureftp、vsftpd(Very Secure)、ServU
- Client: ftp、lftp、wget、curl
*** 响应码
- 1xx: 信息
- 2xx: 成功
- 3xx: 提示需进一步提供补充类信息
- 4xx: 客户端错误
- 5xx: 服务端错误
*** 用户认证
- 虚拟用户: 使用Linux系统的nsswitch和pam进行认证
  - nsswitch: network server switch，名称解析框架
  - pam: pluggable authentication module，用户认证框架
- 系统用户(默认)
- 匿名用户(ftp用户)
** vsftpd
- 用户认证配置文件: /etc/pam.d/vsftpd
- 主配置文件: /etc/vsftpd/vsftpd.conf
  - 配置文件每行前不能有多余空白字符
- 匿名用户(ftp用户)共享资源位置: /var/ftp
  #+BEGIN_SRC conf
  anonymous_enable=YES
  #anon_upload_enable=YES  # 默认不启用匿名用户的上传
  #anon_mkdir_write_enable=YES  # 默认匿名用户不能创建文件夹
  #anon_other_write_enable=YES  # 默认匿名用户不能删除文件和文件夹
  #+END_SRC
- 系统用户默认访问资源位置为用户自己的家目录，同时可以访问其他文件夹
  #+BEGIN_SRC conf
  local_enable=YES

  write_enable=YES
  local_umask=022

  chroot_local_user=YES  # 锁定用户不能访问家目录外的其他目录
  chroot_list_enable=YES  # 只锁定列表文件中的用户
  chroot_list_file=/etc/vsftpd/chroot_list
  #+END_SRC
- 虚拟用户访问资源位置: 由配置文件指定家目录
** lftp
用于连接ftp服务器(默认21端口)，用于代替ftp程序
#+BEGIN_SRC conf
lftp [-p port] [-u user[,password]] SERVER
  子命令
    get: 获取远程的文件
    mget: 获取远程的多个文件
    ls
    help

lftpget URL  # 使用lftp获取一个文件
#+END_SRC
- 使用匿名账户登录ftp，用户名为ftp
